<!doctype html>
<html lang="zh-Hans">
<head>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="always">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="google-site-verification" content="m9HzlxEFMjeLY1dz5g98y0-93U1BVLaGlv_D4c984PI"/>
    <link rel="profile" href="http://gmpg.org/xfn/11"/>

    
    <title>MySQL创建用户和配置远程连接 | 2Dosth</title>
    <meta name="description" content=""/>
    <meta name="keywords" content="MySQL,技术笔记"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="MySQL创建用户和配置远程连接"/>
    <meta property="og:description" content=""/>


    <meta property="og:locale" content="zh-Hans">


    <link href="https://fonts.googleapis.com/css2?family=Playball&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/static/css/style.css" type="text/css">
    <link rel="stylesheet" href="/static/css/code.css" type="text/css">
    
        <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c7f70ec56346e1ef095ec0104e479a46";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


    
</head>

<body data-new-gr-c-s-check-loaded="14.991.0">

<nav>
    <div class="site-name"><a href="/">2Dosth</a></div>
    <ul class="menu">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        <li><a href="https://twitter.com/OnePieceOwner" title="Twitter">
            <svg t="1664500269647" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="2003" width="20" height="20">
                <path d="M868.78260513 350.93851167c-4.19752479 316.58112364-206.64378348 533.42289687-508.84923077 547.04005471-124.62575954 5.70639316-214.91280228-34.551102-293.48715213-84.46745527 92.10982108 14.70125585 206.32520569-22.11723305 267.41045242-74.40833277-90.28704274-8.78247749-143.74276011-54.7393641-168.7552-128.69725356 26.08953618 4.51026781 53.57474644 3.31414245 78.36079771-1.93480569-81.47305755-27.27282508-139.65259487-77.62795213-142.6586621-183.14254588 22.8629151 10.40920798 46.6967339 20.19409687 78.36079772 22.12306782-60.97321937-34.68180056-106.05956011-161.46291966-54.42078633-245.29788718 90.49359316 99.18854928 199.34683533 180.12947692 378.08647293 191.07898346-44.87512251-191.83050029 209.33127293-295.85489687 315.7222473-166.92541994 44.97431338-8.70079088 81.58158405-25.7639567 116.79551453-44.33599088-14.49353846 44.54837607-42.40585299 75.68030997-76.43065983 100.58539031 37.3506188-5.04239772 70.41152364-14.16912593 98.65525243-28.12469971-17.51944388 36.39255157-55.82929687 69.02751909-88.78984388 96.50689458z"
                      fill="#2c2c2c" p-id="2004"></path>
            </svg>
        </a></li>


        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        <li><a href="mailto:intbleem@gmail.com" title="邮件">
            <svg t="1664500756779" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="15481" width="20" height="20">
                <path d="M853.333333 170.666667 170.666667 170.666667C123.733333 170.666667 85.333333 209.066667 85.333333 256l0 512c0 46.933333 38.4 85.333333 85.333333 85.333333l682.666667 0c46.933333 0 85.333333-38.4 85.333333-85.333333L938.666667 256C938.666667 209.066667 900.266667 170.666667 853.333333 170.666667zM853.333333 341.333333l-341.333333 213.333333L170.666667 341.333333 170.666667 256l341.333333 213.333333 341.333333-213.333333L853.333333 341.333333z"
                      p-id="15482" fill="#2c2c2c"></path>
            </svg>
        </a></li>


        
        
        
        
        
        
        
        
        

        <li><a href="/links.html" title="友情链接">
            <svg t="1664502347383" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="60354" width="20" height="20">
                <path d="M510.3 63.8c-247.4 0-448 200.6-448 448s200.6 448 448 448 448-200.6 448-448-200.5-448-448-448z m183.6 645.6c-20.5 20.5-47.3 30.7-74.2 30.7-26.9 0-53.7-10.2-74.2-30.7l-85.9-85.9c-19.8-19.8-30.7-46.1-30.7-74.2 0-11.8 2-23.2 5.7-34-1.4 2.4-3 4.8-5 6.8-12 12-31.5 12-43.4 0l-59.5-59.5c-19.8-19.8-30.7-46.1-30.7-74.2s10.9-54.4 30.7-74.2c19.8-19.8 46.1-30.7 74.2-30.7s54.4 10.9 74.2 30.7l85.9 85.9c29.2 29.2 37.5 71.6 24.9 108.3 1.4-2.5 3-4.9 5.1-6.9 11.6-11.6 31.8-11.6 43.4 0l59.5 59.5c40.9 40.9 40.9 107.5 0 148.4z"
                      p-id="60355" fill="#2c2c2c"></path>
                <path d="M591 544.9c-5.8-5.8-9-13.5-9-21.7 0-2.2 0.3-4.4 0.8-6.6-5.1 11.6-12.3 22.4-21.7 31.9-6.2 6.2-13.2 11.6-20.7 16-4.8 2.8-10.1 4.3-15.6 4.3-2.6 0-5.1-0.3-7.7-1-7.9-2-14.6-7-18.8-14.1-4.4-7.5-5.2-16.1-3.1-23.8-8.2 16.3-5.7 36.6 7.9 50.2L589 666c16.4 16.4 45.1 16.4 61.5 0 17-17 17-44.5 0-61.5L591 544.9zM503.6 455.8c8 2 14.6 7.1 18.8 14.1 4.2 7 5.4 15.3 3.3 23.3 0 0.1-0.1 0.2-0.1 0.3 8-16.3 5.4-36.4-8.1-49.9l-85.9-85.9c-17-17-44.6-17-61.5 0-17 17-17 44.6 0 61.5l59.5 59.5c5.8 5.8 9 13.5 9 21.7 0 2.2-0.3 4.3-0.7 6.4 5.2-11.6 12.4-22.4 21.7-31.6 6.2-6.2 13.1-11.6 20.7-16 7.1-4.3 15.4-5.5 23.3-3.4z"
                      p-id="60356" fill="#2c2c2c"></path>
            </svg>
        </a></li>

        
        
        
        
        
        
        

        <li><a href="/feed.xml" title="RSS订阅">
            <svg t="1664502489548" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="69131" width="20" height="20">
                <path d="M213.333333 128 810.666667 128C857.6 128 896 166.4 896 213.333333L896 810.666667C896 857.6 857.6 896 810.666667 896L213.333333 896C166.4 896 128 857.6 128 810.666667L128 213.333333C128 166.4 166.4 128 213.333333 128M320 640C284.586667 640 256 668.586667 256 704 256 739.413333 284.586667 768 320 768 355.413333 768 384 739.413333 384 704 384 668.586667 355.413333 640 320 640M256 426.666667 256 512C397.226667 512 512 626.773333 512 768L597.333333 768C597.333333 579.413333 444.586667 426.666667 256 426.666667M256 256 256 341.333333C491.52 341.333333 682.666667 532.48 682.666667 768L768 768C768 485.12 538.88 256 256 256Z"
                      p-id="69132" fill="#2c2c2c"></path>
            </svg>
        </a></li>


    </ul>
    <hr>
</nav>



<main>
    
    <div class="header-line"></div>
    <div class="article-meta">
        <h1 class="title">MySQL创建用户和配置远程连接</h1>

    </div>

    <div class="article-body">
        <h2>创建远程连接用户</h2>
<p>在某些情况下，可能别人需要连接你的数据库进行操作，出于安全考虑，我们需要新建一个用户，让该用户只具有一部分的操作权限操作数据库。</p>
<p>当然如果只有你一个人使用这个数据库的话，也可以跳过这一步，直接选择root用户来操作。</p>
<p><strong>创建用户</strong></p>
<p>使用help命令查看如何创建用户</p>
<div class="codehilite"><pre><span></span><code><span class="nb">help</span> create user
</code></pre></div>


<div class="codehilite"><pre><span></span><code>Name: <span class="s1">&#39;CREATE USER&#39;</span>
Description:
Syntax:
CREATE USER user_specification
    <span class="o">[</span>, user_specification<span class="o">]</span> ...

user_specification:
    user
    <span class="o">[</span>
        IDENTIFIED BY <span class="o">[</span>PASSWORD<span class="o">]</span> <span class="s1">&#39;password&#39;</span>
      <span class="p">|</span> IDENTIFIED WITH auth_plugin <span class="o">[</span>AS <span class="s1">&#39;auth_string&#39;</span><span class="o">]</span>
    <span class="o">]</span>
</code></pre></div>


<p>根据帮助说明，接下来我们来创建用户</p>
<div class="codehilite"><pre><span></span><code>create user <span class="s1">&#39;zjc&#39;</span>@<span class="s1">&#39;localhost&#39;</span> <span class="c1"># 创建一个用户zjc，不需要密码即可登录，但只可以在本机登录</span>
create user <span class="s1">&#39;zjc&#39;</span>@<span class="s1">&#39;%&#39;</span>   <span class="c1"># 创建一个用户zjc，不需要密码即可登录，可以在任意主机登录</span>
create user <span class="s1">&#39;zjc&#39;</span>@<span class="s1">&#39;%&#39;</span> identified by <span class="s1">&#39;123456&#39;</span>    <span class="c1"># 创建一个用户zjc，登录时需要密码123456才可以登录，会自动将密码加密</span>
create user <span class="s1">&#39;zjc&#39;</span>@<span class="s1">&#39;%&#39;</span> identified by password <span class="s1">&#39;123456&#39;</span> <span class="c1"># 创建一个用户zjc，登录时需要密码123456才可以登录，会将密码明文存储</span>
</code></pre></div>


<p><strong>修改密码</strong></p>
<p>命令：</p>
<div class="codehilite"><pre><span></span><code><span class="nb">set</span> password <span class="k">for</span> <span class="s1">&#39;username&#39;</span>@<span class="s1">&#39;host&#39;</span> <span class="o">=</span> PASSWORD<span class="o">(</span><span class="s1">&#39;newpassword&#39;</span><span class="o">)</span><span class="p">;</span>
</code></pre></div>


<p>查看帮助命令查看详情</p>
<div class="codehilite"><pre><span></span><code>&gt; <span class="nb">help</span> <span class="nb">set</span> password
Name: <span class="s1">&#39;SET PASSWORD&#39;</span>
Description:
Syntax:
SET PASSWORD <span class="o">[</span>FOR user<span class="o">]</span> <span class="o">=</span>
    <span class="o">{</span>
        PASSWORD<span class="o">(</span><span class="s1">&#39;cleartext password&#39;</span><span class="o">)</span>
      <span class="p">|</span> OLD_PASSWORD<span class="o">(</span><span class="s1">&#39;cleartext password&#39;</span><span class="o">)</span>
      <span class="p">|</span> <span class="s1">&#39;encrypted password&#39;</span>
    <span class="o">}</span>
</code></pre></div>


<p>修改密码：</p>
<div class="codehilite"><pre><span></span><code><span class="nb">set</span> password <span class="k">for</span> <span class="s1">&#39;zjc&#39;</span>@<span class="s1">&#39;%&#39;</span> <span class="o">=</span> PASSWORD<span class="o">(</span><span class="s2">&quot;654321&quot;</span><span class="o">)</span>
</code></pre></div>


<p><strong>删除用户</strong></p>
<p>命令：</p>
<div class="codehilite"><pre><span></span><code>drop user username
</code></pre></div>


<h2>用户授权</h2>
<p><strong>查看用户目前的权限</strong></p>
<div class="codehilite"><pre><span></span><code>&gt; show grants <span class="k">for</span> zjc<span class="p">;</span>
+---------------------------------+
<span class="p">|</span> Grants <span class="k">for</span> zjc@%                <span class="p">|</span>
+---------------------------------+
<span class="p">|</span> GRANT USAGE ON *.* TO <span class="sb">`</span>zjc<span class="sb">`</span>@<span class="sb">`</span>%<span class="sb">`</span> <span class="p">|</span>
+---------------------------------+
</code></pre></div>


<p>USAGE相当于一个占位符，表示目前zjc用户什么权限都没有，需要我们给他授予权限</p>
<p><strong>授权该用户权限</strong></p>
<p>命令：</p>
<div class="codehilite"><pre><span></span><code>grant privileges ON databasename.tablename to <span class="s1">&#39;username&#39;</span>@<span class="s1">&#39;host&#39;</span>
</code></pre></div>


<p>同样使用help命令详情</p>
<div class="codehilite"><pre><span></span><code>&gt; <span class="nb">help</span> grant
Name: <span class="s1">&#39;GRANT&#39;</span>
Description:
Syntax:
GRANT
    priv_type <span class="o">[(</span>column_list<span class="o">)]</span>
      <span class="o">[</span>, priv_type <span class="o">[(</span>column_list<span class="o">)]]</span> ...
    ON <span class="o">[</span>object_type<span class="o">]</span> priv_level
    TO user_specification <span class="o">[</span>, user_specification<span class="o">]</span> ...
    <span class="o">[</span>REQUIRE <span class="o">{</span>NONE <span class="p">|</span> ssl_option <span class="o">[[</span>AND<span class="o">]</span> ssl_option<span class="o">]</span> ...<span class="o">}]</span>
    <span class="o">[</span>WITH with_option ...<span class="o">]</span>

GRANT PROXY ON user_specification
    TO user_specification <span class="o">[</span>, user_specification<span class="o">]</span> ...
    <span class="o">[</span>WITH GRANT OPTION<span class="o">]</span>

object_type:
    TABLE
  <span class="p">|</span> FUNCTION
  <span class="p">|</span> PROCEDURE

priv_level:
    *
  <span class="p">|</span> *.*
  <span class="p">|</span> db_name.*
  <span class="p">|</span> db_name.tbl_name
  <span class="p">|</span> tbl_name
  <span class="p">|</span> db_name.routine_name

user_specification:
    user
    <span class="o">[</span>
        IDENTIFIED BY <span class="o">[</span>PASSWORD<span class="o">]</span> <span class="s1">&#39;password&#39;</span>
      <span class="p">|</span> IDENTIFIED WITH auth_plugin <span class="o">[</span>AS <span class="s1">&#39;auth_string&#39;</span><span class="o">]</span>
    <span class="o">]</span>

ssl_option:
    SSL
  <span class="p">|</span> X509
  <span class="p">|</span> CIPHER <span class="s1">&#39;cipher&#39;</span>
  <span class="p">|</span> ISSUER <span class="s1">&#39;issuer&#39;</span>
  <span class="p">|</span> SUBJECT <span class="s1">&#39;subject&#39;</span>

with_option:
    GRANT OPTION
  <span class="p">|</span> MAX_QUERIES_PER_HOUR count
  <span class="p">|</span> MAX_UPDATES_PER_HOUR count
  <span class="p">|</span> MAX_CONNECTIONS_PER_HOUR count
  <span class="p">|</span> MAX_USER_CONNECTIONS count
</code></pre></div>


<ul>
<li>privileges：用户的操作权限，如SELECT，INSERT，UPDATE等，如果要授予所的权限则使用ALL</li>
<li>databasename：数据库名</li>
<li>tablename：表名，如果要授予该用户对所有数据库和表的相应操作权限则可用<em>表示，如</em>.*</li>
</ul>
<p>给用户zjc授予权限</p>
<div class="codehilite"><pre><span></span><code>grant all on *.* to &#39;zjc&#39;@&#39;%&#39;;  
</code></pre></div>


<p>刷新权限</p>
<div class="codehilite"><pre><span></span><code>flush privileges;
</code></pre></div>


<p><strong>取消该用户的权限</strong></p>
<p>命令：</p>
<div class="codehilite"><pre><span></span><code>revoke privilege ON databasename.tablename FROM <span class="s1">&#39;username&#39;</span>@<span class="s1">&#39;host&#39;</span><span class="p">;</span>
</code></pre></div>


<p>help查看详情</p>
<div class="codehilite"><pre><span></span><code>&gt; <span class="nb">help</span> revoke
Name: <span class="s1">&#39;REVOKE&#39;</span>
Description:
Syntax:
REVOKE
    priv_type <span class="o">[(</span>column_list<span class="o">)]</span>
      <span class="o">[</span>, priv_type <span class="o">[(</span>column_list<span class="o">)]]</span> ...
    ON <span class="o">[</span>object_type<span class="o">]</span> priv_level
    FROM user <span class="o">[</span>, user<span class="o">]</span> ...

REVOKE ALL PRIVILEGES, GRANT OPTION
    FROM user <span class="o">[</span>, user<span class="o">]</span> ...

REVOKE PROXY ON user
    FROM user <span class="o">[</span>, user<span class="o">]</span> ...
</code></pre></div>


<p>说明：同上面的授权部分</p>
<h2>配置远程链接</h2>
<p>找到配置文件中的[mysqld]一项</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># this is only for the mysqld standalone daemon</span>
<span class="o">[</span>mysqld<span class="o">]</span>

<span class="c1">#</span>
<span class="c1"># * Basic Settings</span>
<span class="c1">#</span>
<span class="nv">user</span>                    <span class="o">=</span> mysql
pid-file                <span class="o">=</span> /run/mysqld/mysqld.pid
<span class="nv">socket</span>                  <span class="o">=</span> /run/mysqld/mysqld.sock
<span class="c1">#port                   = 3306</span>
<span class="nv">basedir</span>                 <span class="o">=</span> /usr
<span class="nv">datadir</span>                 <span class="o">=</span> /var/lib/mysql
<span class="nv">tmpdir</span>                  <span class="o">=</span> /tmp
lc-messages-dir         <span class="o">=</span> /usr/share/mysql
<span class="c1">#skip-external-locking</span>
skip-name-resolve

<span class="c1"># Instead of skip-networking the default is now to listen only on</span>
<span class="c1"># localhost which is more compatible and is not less secure.</span>
<span class="c1"># bind-address            = 127.0.0.1</span>
</code></pre></div>


<p>将<strong>bind-address</strong> 注释掉,，然后重启数据库即可</p>
<div class="codehilite"><pre><span></span><code>systemctl restart mysql
</code></pre></div>


<p><strong>问题记录</strong></p>
<p>我在尝试用 navicat连接的时候，出现（2013，XXXXXXXX）的错误，这样是由于mysql在接收到客户端链接的时候需要对dns进行反向解析，由于我实在局域网内，所有反向解析是不可能成功的。</p>
<p>解决办法有两种：</p>
<ol>
<li>把client的ip写在mysql服务器的/etc/hosts文件里，随便给个名字就可以了。</li>
<li>在 my.cnf 中加入 <strong>skip-name-resolve</strong> 。</li>
</ol>
<p>于第一种方法比较笨，也不实用，那么 skip-name-resolve 选项可以禁用dns解析，但是，这样不能在mysql的授权表中使用主机名了，只能使用IP。</p>
<p>什么是mysql的dns反解析</p>
<p>mysql接收到连接请求后，获得的是客户端的ip，为了更好的匹配mysql.user里的权限记录（某些是用hostname定义的）。</p>
<p>如果mysql服务器设置了dns服务器，并且客户端ip在dns上并没有相应的hostname，那么这个过程很慢，导致连接等待。</p>
<p><strong>官方解释</strong></p>
<blockquote>
<p><em>How MySQL</em>
<em>uses DNS When a new thread connects to mysqld, mysqld will</em>
<em>spawn a new thread to handle the request. This thread will first check</em>
<em>if the hostname is in the hostname cache. If not the thread will call</em>
<em>gethostbyaddr_r() and gethostbyname_r() to resolve the hostname. If</em>
<em>the operating system doesn’t support the above thread-safe calls, the</em>
<em>thread will lock a mutex and call gethostbyaddr() and gethostbyname()</em>
<em>instead. Note that in this case no other thread can resolve other</em>
<em>hostnames that is not in the hostname cache until the first thread is</em>
<em>ready. You can disable DNS host lookup by starting mysqld with</em>
<em>–skip-name-resolve. In this case you can however only use IP names in</em>
<em>the MySQL privilege tables. If you have a very slow DNS and many</em>
<em>hosts, you can get more performance by either disabling DNS lookop</em>
<em>with –skip-name-resolve or by increasing the HOST_CACHE_SIZE define</em>
<em>(default: 128) and recompile mysqld. You can disable the hostname</em>
<em>cache with –skip-host-cache. You can clear the hostname cache with</em>
<em>FLUSH HOSTS or mysqladmin flush-hosts. If you don’t want to allow</em>
<em>connections over TCP/IP, you can do this by starting mysqld with</em>
<em>–skip-networking.</em></p>
</blockquote>
<p>根据文档说明，如果你的mysql主机查询DNS很慢或是有很多客户端主机时会导致连接很慢，由于我们的开发机器是不能够连接外网的，所以DNS解析是不可能完成的，从而也就明白了为什么连接那么慢了。同时，请注意在增加该配置参数后，mysql的授权表中的host字段就不能够使用域名而只能够使用 ip地址了，因为这是禁止了域名解析的结果。</p>
    </div>

    <div class="article-attrs">
        <div class="article-detail-date">
            <time>Posted on 2020-12-29</time>
        </div>

        <div class="article-category">
            <span>
                Archived in <a href="/category/Tech.html">Tech</a>
            </span>
        </div>

        <div class="article-tags">
            <ul>
                
                    <li>
                        # <a href="/tag/MySQL.html">MySQL</a>
                    </li>
                
                    <li>
                        # <a href="/tag/技术笔记.html">技术笔记</a>
                    </li>
                
            </ul>
        </div>

    </div>

    
    
    

</main>

<footer>
    &copy; 2020-2022 ·
    <a href="/sitemap.xml">Sitemap</a> ·
    
    
    Powered by <a href="https://github.com/Cocojcc/zogn">zogn</a>
</footer>


</body>
</html>