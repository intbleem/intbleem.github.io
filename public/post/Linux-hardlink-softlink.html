<!doctype html>
<html lang="zh-Hans">
<head>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="always">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="google-site-verification" content="m9HzlxEFMjeLY1dz5g98y0-93U1BVLaGlv_D4c984PI"/>
    <link rel="profile" href="http://gmpg.org/xfn/11"/>

    
    <title>Linux中的软链接和硬链接 | 2Dosth</title>
    <meta name="description" content=""/>
    <meta name="keywords" content="Linux,unix,技术笔记"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Linux中的软链接和硬链接"/>
    <meta property="og:description" content=""/>


    <meta property="og:locale" content="zh-Hans">


    <link href="https://fonts.googleapis.com/css2?family=Playball&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/static/css/style.css" type="text/css">
    <link rel="stylesheet" href="/static/css/code.css" type="text/css">
    
        <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c7f70ec56346e1ef095ec0104e479a46";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


    
</head>

<body data-new-gr-c-s-check-loaded="14.991.0">

<nav>
    <div class="site-name"><a href="/">2Dosth</a></div>
    <ul class="menu">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        <li><a href="https://twitter.com/OnePieceOwner" title="Twitter">
            <svg t="1664500269647" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="2003" width="20" height="20">
                <path d="M868.78260513 350.93851167c-4.19752479 316.58112364-206.64378348 533.42289687-508.84923077 547.04005471-124.62575954 5.70639316-214.91280228-34.551102-293.48715213-84.46745527 92.10982108 14.70125585 206.32520569-22.11723305 267.41045242-74.40833277-90.28704274-8.78247749-143.74276011-54.7393641-168.7552-128.69725356 26.08953618 4.51026781 53.57474644 3.31414245 78.36079771-1.93480569-81.47305755-27.27282508-139.65259487-77.62795213-142.6586621-183.14254588 22.8629151 10.40920798 46.6967339 20.19409687 78.36079772 22.12306782-60.97321937-34.68180056-106.05956011-161.46291966-54.42078633-245.29788718 90.49359316 99.18854928 199.34683533 180.12947692 378.08647293 191.07898346-44.87512251-191.83050029 209.33127293-295.85489687 315.7222473-166.92541994 44.97431338-8.70079088 81.58158405-25.7639567 116.79551453-44.33599088-14.49353846 44.54837607-42.40585299 75.68030997-76.43065983 100.58539031 37.3506188-5.04239772 70.41152364-14.16912593 98.65525243-28.12469971-17.51944388 36.39255157-55.82929687 69.02751909-88.78984388 96.50689458z"
                      fill="#2c2c2c" p-id="2004"></path>
            </svg>
        </a></li>


        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        <li><a href="mailto:intbleem@gmail.com" title="邮件">
            <svg t="1664500756779" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="15481" width="20" height="20">
                <path d="M853.333333 170.666667 170.666667 170.666667C123.733333 170.666667 85.333333 209.066667 85.333333 256l0 512c0 46.933333 38.4 85.333333 85.333333 85.333333l682.666667 0c46.933333 0 85.333333-38.4 85.333333-85.333333L938.666667 256C938.666667 209.066667 900.266667 170.666667 853.333333 170.666667zM853.333333 341.333333l-341.333333 213.333333L170.666667 341.333333 170.666667 256l341.333333 213.333333 341.333333-213.333333L853.333333 341.333333z"
                      p-id="15482" fill="#2c2c2c"></path>
            </svg>
        </a></li>


        
        
        
        
        
        
        
        
        

        <li><a href="/links.html" title="友情链接">
            <svg t="1664502347383" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="60354" width="20" height="20">
                <path d="M510.3 63.8c-247.4 0-448 200.6-448 448s200.6 448 448 448 448-200.6 448-448-200.5-448-448-448z m183.6 645.6c-20.5 20.5-47.3 30.7-74.2 30.7-26.9 0-53.7-10.2-74.2-30.7l-85.9-85.9c-19.8-19.8-30.7-46.1-30.7-74.2 0-11.8 2-23.2 5.7-34-1.4 2.4-3 4.8-5 6.8-12 12-31.5 12-43.4 0l-59.5-59.5c-19.8-19.8-30.7-46.1-30.7-74.2s10.9-54.4 30.7-74.2c19.8-19.8 46.1-30.7 74.2-30.7s54.4 10.9 74.2 30.7l85.9 85.9c29.2 29.2 37.5 71.6 24.9 108.3 1.4-2.5 3-4.9 5.1-6.9 11.6-11.6 31.8-11.6 43.4 0l59.5 59.5c40.9 40.9 40.9 107.5 0 148.4z"
                      p-id="60355" fill="#2c2c2c"></path>
                <path d="M591 544.9c-5.8-5.8-9-13.5-9-21.7 0-2.2 0.3-4.4 0.8-6.6-5.1 11.6-12.3 22.4-21.7 31.9-6.2 6.2-13.2 11.6-20.7 16-4.8 2.8-10.1 4.3-15.6 4.3-2.6 0-5.1-0.3-7.7-1-7.9-2-14.6-7-18.8-14.1-4.4-7.5-5.2-16.1-3.1-23.8-8.2 16.3-5.7 36.6 7.9 50.2L589 666c16.4 16.4 45.1 16.4 61.5 0 17-17 17-44.5 0-61.5L591 544.9zM503.6 455.8c8 2 14.6 7.1 18.8 14.1 4.2 7 5.4 15.3 3.3 23.3 0 0.1-0.1 0.2-0.1 0.3 8-16.3 5.4-36.4-8.1-49.9l-85.9-85.9c-17-17-44.6-17-61.5 0-17 17-17 44.6 0 61.5l59.5 59.5c5.8 5.8 9 13.5 9 21.7 0 2.2-0.3 4.3-0.7 6.4 5.2-11.6 12.4-22.4 21.7-31.6 6.2-6.2 13.1-11.6 20.7-16 7.1-4.3 15.4-5.5 23.3-3.4z"
                      p-id="60356" fill="#2c2c2c"></path>
            </svg>
        </a></li>

        
        
        
        
        
        
        

        <li><a href="/feed.xml" title="RSS订阅">
            <svg t="1664502489548" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="69131" width="20" height="20">
                <path d="M213.333333 128 810.666667 128C857.6 128 896 166.4 896 213.333333L896 810.666667C896 857.6 857.6 896 810.666667 896L213.333333 896C166.4 896 128 857.6 128 810.666667L128 213.333333C128 166.4 166.4 128 213.333333 128M320 640C284.586667 640 256 668.586667 256 704 256 739.413333 284.586667 768 320 768 355.413333 768 384 739.413333 384 704 384 668.586667 355.413333 640 320 640M256 426.666667 256 512C397.226667 512 512 626.773333 512 768L597.333333 768C597.333333 579.413333 444.586667 426.666667 256 426.666667M256 256 256 341.333333C491.52 341.333333 682.666667 532.48 682.666667 768L768 768C768 485.12 538.88 256 256 256Z"
                      p-id="69132" fill="#2c2c2c"></path>
            </svg>
        </a></li>


    </ul>
    <hr>
</nav>



<main>
    
    <div class="header-line"></div>
    <div class="article-meta">
        <h1 class="title">Linux中的软链接和硬链接</h1>

    </div>

    <div class="article-body">
        <h2>Linux文件系统</h2>
<p>在 UNIX 系统中，操作系统为磁盘上的文本与图像、鼠标与键盘等输入设备及网络交互等 I/O 操作设计了一组通用 API，使他们被处理时均可统一使用字节流方式。</p>
<p>换言之，<strong>UNIX 系统中除进程之外的一切皆是文件</strong>，而 Linux 保持了这一特性。为了便于文件的管理，Linux 还引入了目录（有时亦被称为文件夹）这一概念。目录使文件可被分类管理，且目录的引入使 Linux 的文件系统形成一个层级结构的目录树。</p>
<h3>Linux 系统的顶层目录结构</h3>
<div class="codehilite"><pre><span></span><code><span class="o">/</span>              <span class="err">根目录</span>
<span class="err">├──</span> <span class="n">bin</span>     <span class="err">存放用户二进制文件</span>
<span class="err">├──</span> <span class="n">boot</span>    <span class="err">存放内核引导配置文件</span>
<span class="err">├──</span> <span class="n">dev</span>     <span class="err">存放设备文件</span>
<span class="err">├──</span> <span class="n">etc</span>     <span class="err">存放系统配置文件</span>
<span class="err">├──</span> <span class="n">home</span>    <span class="err">用户主目录</span>
<span class="err">├──</span> <span class="n">lib</span>     <span class="err">动态共享库</span>
<span class="err">├──</span> <span class="n">lost</span><span class="o">+</span><span class="n">found</span>  <span class="err">文件系统恢复时的恢复文件</span>
<span class="err">├──</span> <span class="n">media</span>   <span class="err">可卸载存储介质挂载点</span>
<span class="err">├──</span> <span class="n">mnt</span>     <span class="err">文件系统临时挂载点</span>
<span class="err">├──</span> <span class="n">opt</span>     <span class="err">附加的应用程序包</span>
<span class="err">├──</span> <span class="n">proc</span>    <span class="err">系统内存的映射目录，提供内核与进程信息</span>
<span class="err">├──</span> <span class="n">root</span>    <span class="n">root</span> <span class="err">用户主目录</span>
<span class="err">├──</span> <span class="n">sbin</span>    <span class="err">存放系统二进制文件</span>
<span class="err">├──</span> <span class="n">srv</span>     <span class="err">存放服务相关数据</span>
<span class="err">├──</span> <span class="n">sys</span>     <span class="n">sys</span> <span class="err">虚拟文件系统挂载点</span>
<span class="err">├──</span> <span class="n">tmp</span>     <span class="err">存放临时文件</span>
<span class="err">├──</span> <span class="n">usr</span>     <span class="err">存放用户应用程序</span>
<span class="err">└──</span> <span class="k">var</span>     <span class="err">存放邮件、系统日志等变化文件</span>
</code></pre></div>


<p>Linux 与其他类 UNIX 系统一样并不区分文件与目录：目录是记录了其他文件名的文件。使用命令 mkdir 创建目录时，若期望创建的目录的名称与现有的文件名（或目录名）重复，则会创建失败。</p>
<h2>硬链接与软链接的联系与区别</h2>
<p>我们知道文件都有文件名与数据，这在 Linux 上被分成两个部分：用户数据 (user data) 与元数据 (metadata)。用户数据，即文件数据块 (data block)，数据块是记录文件真实内容的地方；而元数据则是文件的附加属性，如文件大小、创建时间、所有者等信息。在 Linux 中，元数据中的 inode 号（inode 是文件元数据的一部分但其并不包含文件名，inode 号即索引节点号）才是文件的唯一标识而非文件名。文件名仅是为了方便人们的记忆和使用，系统或程序通过 inode 号寻找正确的文件数据块。</p>
<p>在 Linux 系统中查看 inode 号可使用命令 stat 或 ls -i（若是 AIX 系统，则使用命令 istat）。</p>
<div class="codehilite"><pre><span></span><code> <span class="c1"># stat /home/harris/source/glibc-2.16.0.tar.xz</span>
 File: <span class="sb">`</span>/home/harris/source/glibc-2.16.0.tar.xz<span class="err">&#39;</span>
 Size: <span class="m">9990512</span>      Blocks: <span class="m">19520</span>      IO Block: <span class="m">4096</span>   regular file
Device: 807h/2055d      Inode: <span class="m">2485677</span>     Links: <span class="m">1</span>
Access: <span class="o">(</span><span class="m">0600</span>/-rw-------<span class="o">)</span>  Uid: <span class="o">(</span> <span class="m">1000</span>/  harris<span class="o">)</span>   Gid: <span class="o">(</span> <span class="m">1000</span>/  harris<span class="o">)</span>
...
...
<span class="c1"># ls -i -F /home/harris/Desktop/glibc.tar.xz</span>
<span class="m">2485677</span> /home/harris/Desktop/glibc.tar.xz
</code></pre></div>


<p>为解决文件的共享使用，Linux 系统引入了两种链接：硬链接 (hard link) 与软链接（又称符号链接，即 soft link 或 symbolic link）。链接为 Linux 系统解决了文件的共享使用，还带来了隐藏文件路径、增加权限安全及节省存储等好处。若一个 inode 号对应多个文件名，则称这些文件为硬链接。换言之，硬链接就是同一个文件使用了多个别名（见 图 2.hard link 就是 file 的一个别名，他们有共同的 inode）。硬链接可由命令 link 或 ln 创建。</p>
<h3>创建硬链接</h3>
<div class="codehilite"><pre><span></span><code>link oldfile newfile
ln oldfile newfile
</code></pre></div>


<p>查找有相同 inode 号的文件</p>
<div class="codehilite"><pre><span></span><code>df -i --print-type
</code></pre></div>


<p>由于硬链接是有着相同 inode 号仅文件名不同的文件，因此硬链接存在以下几点特性</p>
<ul>
<li>文件有相同的 inode 及 data block；</li>
<li>只能对已存在的文件进行创建；</li>
<li>不能交叉文件系统进行硬链接的创建；</li>
<li>不能对目录进行创建，只可对文件创建；</li>
<li>删除一个硬链接文件并不影响其他有相同 inode 号的文件。</li>
</ul>
<p>硬链接不能对目录创建是受限于文件系统的设计。现 Linux 文件系统中的目录均隐藏了两个个特殊的目录：当前目录（.）与父目录（..）。查看这两个特殊目录的 inode 号可知其实这两目录就是两个硬链接。若系统允许对目录创建硬链接，则会产生目录环。</p>
<p>软链接与硬链接不同，若文件用户数据块中存放的内容是另一文件的路径名的指向，则该文件就是软连接。软链接就是一个普通文件，只是数据块内容有点特殊。软链接有着自己的 inode 号以及用户数据块。因此软链接的创建与使用没有类似硬链接的诸多限制：
- 软链接有自己的文件属性及权限等；
- 可对不存在的文件或目录创建软链接；
- 软链接可交叉文件系统；
- 软链接可对文件或目录创建；
- 创建软链接时，链接计数 i_nlink 不会增加；
- 删除软链接并不影响被指向的文件，但若被指向的原文件被删除，则相关软连接被称为死链接（即 dangling link，若被指向路径文件被重新创建，死链接可恢复为正常的软链接）。</p>
<h3>创建软连接</h3>
<div class="codehilite"><pre><span></span><code>ln -s 源文件路径 目标路径
</code></pre></div>


<p>我们尝试对不存在的文件创建软连接</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ls -li</span>
 total <span class="m">0</span>

 // 可对不存在的文件创建软链接
 <span class="c1"># ln -s old.file soft.link</span>
 <span class="c1"># ls -liF</span>
 total <span class="m">0</span>
 <span class="m">789467</span> lrwxrwxrwx <span class="m">1</span> root root <span class="m">8</span> Sep  <span class="m">1</span> <span class="m">18</span>:00 soft.link -&gt; old.file 

 // 由于被指向的文件不存在，此时的软链接 soft.link 就是死链接
 <span class="c1"># cat soft.link </span>
 cat: soft.link: No such file or directory 

 // 创建被指向的文件 old.file，soft.link 恢复成正常的软链接
 <span class="c1"># echo &quot;This is an original file_A&quot; &gt;&gt; old.file</span>
 <span class="c1"># cat soft.link</span>
 This is an original file_A

 // 对不存在的目录创建软链接
 <span class="c1"># ln -s old.dir soft.link.dir</span>
 <span class="c1"># mkdir -p old.dir/test</span>
 <span class="c1"># tree . -F --inodes</span>
 .
├── <span class="o">[</span> <span class="m">789497</span><span class="o">]</span>  old.dir/
│   └── <span class="o">[</span> <span class="m">789498</span><span class="o">]</span>  test/
├── <span class="o">[</span> <span class="m">789495</span><span class="o">]</span>  old.file
├── <span class="o">[</span> <span class="m">789495</span><span class="o">]</span>  soft.link -&gt; old.file
└── <span class="o">[</span> <span class="m">789497</span><span class="o">]</span>  soft.link.dir -&gt; old.dir/
</code></pre></div>


<p>当然软链接的用户数据也可以是另一个软链接的路径，其解析过程是递归的。但需注意：软链接创建时原文件的路径指向使用绝对路径较好。使用相对路径创建的软链接被移动后该软链接文件将成为一个死链接（如下所示的软链接 a 使用了相对路径，因此不宜被移动），因为链接数据块中记录的亦是相对路径指向。</p>
    </div>

    <div class="article-attrs">
        <div class="article-detail-date">
            <time>Posted on 2020-11-24</time>
        </div>

        <div class="article-category">
            <span>
                Archived in <a href="/category/Tech.html">Tech</a>
            </span>
        </div>

        <div class="article-tags">
            <ul>
                
                    <li>
                        # <a href="/tag/Linux.html">Linux</a>
                    </li>
                
                    <li>
                        # <a href="/tag/unix.html">unix</a>
                    </li>
                
                    <li>
                        # <a href="/tag/技术笔记.html">技术笔记</a>
                    </li>
                
            </ul>
        </div>

    </div>

    
    
    

</main>

<footer>
    &copy; 2020-2022 ·
    <a href="/sitemap.xml">Sitemap</a> ·
    
    
    Powered by <a href="https://github.com/Cocojcc/zogn">zogn</a>
</footer>


</body>
</html>