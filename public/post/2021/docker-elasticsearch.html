<!doctype html>
<html lang="zh-Hans">
<head>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="always">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="google-site-verification" content="m9HzlxEFMjeLY1dz5g98y0-93U1BVLaGlv_D4c984PI"/>
    <link rel="profile" href="http://gmpg.org/xfn/11"/>
    <link rel="canonical" href="https://zorox.me">
    <meta property="og:locale" content="zh-Hans">

    
    <title>Run Elasticsearch by docker | ZORO.X</title>
    <meta name="description" content=""/>
    <meta name="keywords" content="技,术"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Run Elasticsearch by docker"/>
    <meta property="og:description" content=""/>
    <meta property="og:url" content="https://zorox.me/post/2021/docker-elasticsearch.html">
    <meta property="og:site_name" content="2dosth">
    <meta property="article:tag" content="技,术">
    <meta property="article:category" content="技术">
    <meta property="article:published_date" content="2021-04-30">

    <link rel="canonical" href="https://zorox.me/post/2021/docker-elasticsearch.html">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:description" content="">
    <meta name="twitter:title" content="Run Elasticsearch by docker">
    <meta name="twitter:site" content="@2dosth">
    <meta name="twitter:creator" content="@2dosth">
    <style>

        img {
            max-width: 100%;
        }

        blockquote {
            padding: 0 0 0 15px;
            margin: 0 10px 0 0;
            border-left: 1px solid #615b5b;
        }

        pre {
            border: 1px solid #ccc;
            padding: 1em;
            overflow-x: auto;
            background: #f7f7f7;
        }

        p code {
            font-weight: bold;
        }

        table {
            margin: auto;
            border-top: 1px solid #666;
            border-bottom: 1px solid #666
        }

        table thead th {
            border-bottom: 1px solid #ddd
        }

        td, th {
            padding: 5px
        }

        tfoot, thead, tr:nth-child(even) {
            background: #eee
        }

    </style>


    

    <style>
        body {
            font-family: monospace;
            max-width: 650px;
            margin: 8px auto;
            padding: 0 8px;
            font-size: 1rem;
        }
    </style>
</head>

<body>


    <a href="/">..</a>
    <br>


<main>
    

    <article class="article">
        <h1>Run Elasticsearch by docker</h1>
        <p><strong>1. Download the docker image of Elasticsearch, taking version 7.6.0 as an example</strong></p>
<div class="codehilite"><pre><span></span><code>    docker pull elasticsearch:7.6.0
</code></pre></div>


<p><strong>2. Create a container and run it.</strong></p>
<p>if your command is:</p>
<div class="codehilite"><pre><span></span><code>   docker run -d --name es -p <span class="m">9200</span>:9200 -p <span class="m">9300</span>:9300 elasticsearch:7.6.0
</code></pre></div>


<p>It may exit shortly after starting. To find out the reason, view logs by log command:</p>
<div class="codehilite"><pre><span></span><code>   docker logs es
</code></pre></div>


<p>Some error message like <code>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</code> may appear. Go the following command:</p>
<div class="codehilite"><pre><span></span><code>   <span class="c1"># change the variable</span>
   sysctl -w vm.max_map_count<span class="o">=</span><span class="m">262144</span>
   <span class="c1"># check the variable value</span>
   sysctl -n vm.max_map_count
</code></pre></div>


<p>If the error message is <code>the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured</code>, which means the container has wrong configuration and can be corrected by setting those prompted environment variables or setting to standalone development mode by <code>discovery.type=single-node</code>.</p>
<p>In short, the correct command is:</p>
<div class="codehilite"><pre><span></span><code>   docker run -d --name es -p <span class="m">9200</span>:9200 -p <span class="m">9300</span>:9300 -e discovery.type<span class="o">=</span>single-node elasticsearch:7.6.0
</code></pre></div>


<h2>Using IK Chinese segmentation plugin.</h2>
<p><strong>1. Download the plugin.</strong></p>
<p>The plugin version must equal the Elasticsearch version. Version 7.6.0 download link is <a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.0/elasticsearch-analysis-ik-7.6.0.zip">https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.0/elasticsearch-analysis-ik-7.6.0.zip</a>。</p>
<p><strong>2. Unzip to an empty directory, which is referred to as  <em><code>$IK</code></em></strong>.</p>
<p><strong>3. Copy the <em><code>$IK</code></em> into the directory of the container's plugin.</strong></p>
<div class="codehilite"><pre><span></span><code>   docker cp <span class="nv">$IK</span> es:/usr/share/elasticsearch/plugins/ik
</code></pre></div>


<p>This plugin provides analyzer and tokenizer named <code>ik_smart</code> and <code>ik_max_word</code> where <code>ik_smart</code> splits by the coarsest granularity, while <code>ik_max_word</code> will exhaust all kinds of split combinations.</p>
<p>Find more info at <a href="https://github.com/medcl/elasticsearch-analysis-ik">IK</a>.</p>
        <hr>
        <span>
            Date:&nbsp;2021-04-30<br>
            Category:&nbsp;<a href="/category/技术.html">技术</a><br>
            Tags:&nbsp;
            <a href="/tag/Elasticsearch.html">Elasticsearch</a>&nbsp;
        
            <a href="/tag/Docker.html">Docker</a>&nbsp;
        
            <a href="/tag/技术笔记.html">技术笔记</a>&nbsp;
        
        </span>
    </article>

</main>


    <footer>
    <hr>
    &copy; 2020-2022 ZOROX · CC BY-SA 4.0
</footer>




</body>
</html>