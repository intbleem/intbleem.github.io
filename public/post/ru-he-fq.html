<!doctype html>
<html lang="zh-Hans">
<head>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="always">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="google-site-verification" content="m9HzlxEFMjeLY1dz5g98y0-93U1BVLaGlv_D4c984PI"/>
    <link rel="profile" href="http://gmpg.org/xfn/11"/>

    
    <title>科学有效的上网方法 | 2Dosth</title>
    <meta name="description" content=""/>
    <meta name="keywords" content="V2Ray,Vmess,tls"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="科学有效的上网方法"/>
    <meta property="og:description" content=""/>


    <meta property="og:locale" content="zh-Hans">

    <link href="https://fonts.googleapis.com/css2?family=Arvo&family=Playball&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/static/css/style.css" type="text/css">
    <link rel="stylesheet" href="/static/css/code.css" type="text/css">
    
        <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c7f70ec56346e1ef095ec0104e479a46";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


    
</head>

<body data-new-gr-c-s-check-loaded="14.991.0">

<nav>
    <div class="site-name"><a href="/">2Dosth</a></div>
    <ul class="menu">
        <li><a href="https://twitter.com/OnePieceOwner" title="Twitter">
            <svg t="1664446653212" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="24630" width="20" height="20">
                <path d="M967.97698918 285.54371282a19.51843191 19.51843191 0 0 0-23.15815385-15.03267009l-56.71851397 12.08261653a1140.39525014 1140.39525014 0 0 0 12.82829859-18.4658416 580.79646268 580.79646268 0 0 0 14.74443304-22.89442279 287.00940399 287.00940399 0 0 0 7.02271453-12.18880912l3.37599089-6.60261197c1.12027351-2.28022336 2.17986553-4.92920342 3.2382906-7.40430769a17.92087521 17.92087521 0 0 0-23.34603306-23.61443191l-3.13093105
                1.30348491c-4.45425413 1.56604901-8.83265641 3.19394644-13.26123761 4.6911453-4.51610256 1.3466621-8.94468376 2.80068376-13.47362279 4.05282279-4.57795099 1.15294815-9.06954758 2.43076011-13.66150199 3.47051396-4.62812992 0.9709037-9.17574017 2.07250598-13.81087179 2.9372171-4.67364103 0.80753048-9.26559544 1.73525697-13.94973904 2.44943133-4.69814701 0.66399544-9.3461151 1.41551226-14.04426211 2.01065755-3.11225983 0.39442963-6.23852308 0.71417436-9.35778462 1.0455886a169.70043077
                169.70043077 0 0 0-41.38477037-30.21704387c-20.42165242-10.60408889-42.7454359-16.83094245-65.04471338-18.99797151-22.31794872-2.18570029-44.65456867-0.43177208-66.03895612 4.57911795a213.79719658 213.79719658 0 0 0-60.77833846 24.6168433c-18.87310769 11.2809208-36.12415271 25.60058348-50.61185641 42.70109174-14.47603418 17.06199886-26.08953618 36.98769687-33.5055134 58.49111339-7.47315784 21.47891054-10.62976183 44.36749857-9.82806609 66.64810485 0.19488091 6.27003077 0.73984729 12.47121139 1.5345413 18.60937664-3.03757492-0.34425072-6.08215157-0.66983021-9.11972649-1.08409802a444.38799316 444.38799316 0 0 1-25.85731282-4.03998631 460.24803191 460.24803191 0 0
                1-25.65659715-5.33646952 520.86999886 520.86999886 0 0 1-50.47415612-14.5577208 541.65340627 541.65340627 0 0 1-49.00263021-19.57444558C261.22677607 305.91401936 202.27938462 263.95860968 149.89492877 214.54988034a18.86727293 18.86727293 0 0 0-31.5392 6.01913618l-0.47611624 1.24630428c-2.11685014 5.53718518-4.13334245 11.13155099-5.73089915 16.85661538-1.5975567 5.71806268-3.00723418 11.50614245-3.99097435 17.36307236-1.09576752 5.83825869-1.81577664 11.74420056-2.26038518 17.65130941-0.51345869 5.91294359-0.64532422 11.83872364-0.59514531 17.75166723 0.09335612 5.90710883 0.42010256 11.81421766 0.97673847 17.69565357a235.22242735 235.22242735 0 0 0 2.48093903
                17.50077264 231.05407636 231.05407636 0 0 0 9.05087635 34.07498576 221.44072934 221.44072934 0 0 0 6.42756923 16.45635099 205.80591226 205.80591226 0 0 0 7.65987009 15.99773904 205.06723191 205.06723191 0 0 0 8.92017778 15.47727863 191.87367749 191.87367749 0 0 0 10.25400341 14.890302 189.47675897 189.47675897 0 0 0 5.64337779 7.17675213c-4.70981652 0.6336547-9.44063817 1.15294815-14.18779715 1.49719886-4.25937322 0.30807521-8.53041595 0.47028149-12.59024046 0.39559658-2.09234415 0-4.07732877-0.08752136-5.95728775-0.25089458-2.07250598-0.08168662-3.53236239-0.39442963-5.35514075-0.57647408a11.90757379 11.90757379 0 0 0-17.12501424 10.44188262l-0.01867122
                0.93939601c-0.13186553 5.92578005-0.11319431 11.90173903 0.42010256 17.91504046a135.44806838 135.44806838 0 0 0 2.7925151 18.00256182 132.70573219 132.70573219 0 0 0 13.12353732 34.52542907c5.95028604 10.88765812 13.36042849 20.93511111 21.63528205 29.97315099a200.7063339 200.7063339 0 0 0 26.99625755 24.40329116c17.60929915 13.31725128 36.61894017 23.87816296 56.01134132 32.89869859-1.04558861 0.30690826-2.08534245 0.63832251-3.13793276 0.92655953-2.38641595 0.62665299-4.76699715 1.35949857-7.1779191 1.84728434-2.40508718 0.50762393-4.82301082 1.17862108-7.24676923 1.57888547-4.85451851 0.93356125-9.74754644 1.69207977-14.65807863 2.26155213-4.91053219 0.53796467-9.81522963
                0.83320342-14.7456 0.98957494a18.54052649 18.54052649 0 0 0-18.68406154 27.2669903l0.81336525 1.48436239c9.90975271 18.10875441 23.12664615 33.68055612 37.58400911 47.16001369 14.50637492 13.50513048 30.34774245 25.03111111 46.80876125 35.18358974a415.86886382 415.86886382 0 0 0 47.76332764 25.04978234c-1.2288 0.80753048-2.41909059 1.65940513-3.6525584 2.44943133a364.0235396 364.0235396 0 0 1-53.70661197 28.49345641c-18.59770713 7.89909516-37.80923077 14.08160456-57.22030313 17.79017665-4.83584729 0.90205356-9.69736752 1.65940513-14.57522508 2.28605811a241.32558405 241.32558405 0 0 1-14.57055726 1.25914074 219.27019944 219.27019944 0 0 1-14.4877037 0.13069858 197.96166382
                197.96166382 0 0 1-14.31849573-1.07009459h-0.01400342l-0.19954872-0.03850941a23.13831567 23.13831567 0 0 0-13.84354644 43.47828149c18.8416 9.72070655 38.26550883 19.04815043 58.48527863 27.18997151a449.10481139 449.10481139 0 0 0 62.61395329 20.20226553 463.77572649 463.77572649 0 0 0 64.94318859 10.74762393c10.86781995 0.88338234 21.74147465 1.69791453 32.57195215 1.99198632 5.39365014 0.29523875 10.91099715 0.30807521 16.41200683 0.34541766 5.45549857 0.02450598 11.15605697 0.14353505 16.21012422-0.03734244l15.58463818-0.35125243 16.54854016-0.91489003c10.82464274-0.41310085 21.61077607-1.74692649 32.41558064-2.76217436 21.55359544-2.63030883 43.09552136-5.99463021 64.33053902-11.09304159
                21.30853561-4.71098348 42.26698575-11.18756467 62.90685812-18.55452991 20.63987236-7.42764672 40.69043418-16.52986894 60.32789516-26.47696411 19.3982359-10.40920798 38.40904388-21.66562279 56.380098-34.52542905 17.85202508-12.97883533 35.30962051-26.64617208 51.21400342-42.0370963 16.0105755-15.24038747 31.23695954-31.37582678 44.92413448-48.75173561 7.14057664-8.47440228 13.36159544-17.62096867 19.95020398-26.48980058 6.03780741-9.24459031 12.43386894-18.28379715 17.91504046-27.86680341 11.56915784-18.82993048 21.42756467-38.60509174 30.43526382-58.69299601 8.95752023-20.14391795 16.38049915-40.85264046 22.96327293-61.80525584 6.20118063-21.04013675 11.75703704-42.28682393 15.6348171-63.81591339 2.192702-10.63092877 3.78325697-21.73563989 5.38664843-32.81701197 0.91489003-5.6935567 1.40384274-10.7604604 1.96047864-15.92188718l0.36992364-3.33281367c1.4913641-1.35366382
                3.05741311-2.65598176 4.47292536-4.04582109l7.6668718-7.44165013c2.59296638-2.43659487 4.94203989-5.11124787 7.42881367-7.65520229 2.41792364-2.59296638 4.94203989-5.07974017 7.24093447-7.76722963l7.00871111-7.96094359c2.36190997-2.61863931 4.50443305-5.43099259 6.75898347-8.13015157 2.2358792-2.72483191 4.48459487-5.42515784 6.57693904-8.25034757a404.60077949 404.60077949 0 0 0 24.07771167-34.47525014 383.96790883 383.96790883 0 0 0 10.69277721-18.12742564c1.68507806-3.12626325 3.37599088-6.18250941 4.97938234-9.39629402a251.46872707 251.46872707 0 0 0 4.90469744-10.13497436l1.14011168-2.46810257a19.5429379 19.5429379 0 0 0 1.35366381-12.23315327z m-86.35441596 51.93401253c-2.17286382 2.18570029-4.47175841 4.240702-6.74498006 6.31320798-2.28722508 2.04916695-4.47876011 4.20335954-6.85934131 6.15800342l-7.00287635 5.95145299c-2.29889458 2.01649231-4.79150313 3.80776296-7.16508263
                5.72389744-2.43076011 1.84845128-4.74249117 3.84627236-7.24210141 5.57569458l-7.39847295 5.32946781c-4.89769572 3.55920228-10.07079202 6.70296979-15.05717606 10.07312593a29.32782678 29.32782678 0 0 0-12.68476353 21.44040114l-0.09335613 1.04675554-1.41551225 15.52745756c-0.46327977 5.18126495-0.90205356 10.46755556-1.59172193 15.05250826-1.23930256 9.50832136-2.38641595 19.00380627-4.23370029 28.78169345-3.14493447 19.46825299-7.80457208 38.57358405-13.00450827 57.49570371-5.54301995 18.80425755-11.82588718 37.38912821-19.44841481 55.38585526-7.68554303 17.9453812-16.07359088 35.62819829-26.00784957 52.39612535-4.64796809 8.58176183-10.19098803 16.59405128-15.33957835 24.87473961-5.68188718 7.88625869-10.98684901 16.07942564-17.14485242 23.61443191-11.74420056 15.52745755-24.90508034 29.90896867-38.74279203 43.57747236-13.72335043 13.81203875-28.90655726 26.069698-44.43518176 37.827902-15.65232136
                11.63100627-32.30822108 21.87334017-49.34571396 31.44934473-17.30122393 9.11389174-35.00271226 17.57779146-53.38103248 24.5421584-18.37832023 6.91535498-37.10672593 13.11653561-56.32408433 17.70265527-19.11700056 4.96654587-38.66694017 8.35537322-58.31607065 11.11171282-9.87241026 1.08293106-19.70631111 2.51127977-29.66040798 3.0504114l-14.56355556 1.08993277-15.57763646 0.63248774c-5.33063476 0.28240228-10.02178005 0.21355213-14.96381995 0.28823705-4.89186097 0.05017892-9.77205242 0.13770029-14.76427123-0.04434417-9.95993162-0.10035784-19.82534017-0.66399544-29.69074872-1.28364673a414.61672479 414.61672479 0 0 1-58.16553389-8.55608888 347.42482051 347.42482051 0 0 1-14.21347008-3.43317151 366.20923989 366.20923989 0 0 0 31.00590312-9.19557836 421.21233505 421.21233505 0 0 0 64.30486611-28.70000683c20.58385869-11.33109971 40.33918176-24.23525014
                59.13060285-39.27492193a31.40733447 31.40733447 0 0 0-11.11171282-54.73352935l-2.4120889-0.66399544-0.00583475-0.01166952c-32.78433732-5.469502-65.53249915-14.98365812-95.74837608-28.79569686-15.07701425-6.92819146-29.52854245-15.01399886-42.60773561-24.50364901-0.52512821-0.38276011-1.00824615-0.80169572-1.53454131-1.18445583 1.61039316-0.10619259 3.22078633-0.21938689 4.83001254-0.31274302a226.63833162 226.63833162 0 0 0 18.31530485-2.0048228 228.4797812 228.4797812 0 0 0 36.54892307-8.48140399 174.87352707 174.87352707 0 0 0 18.2849641-6.93402621c3.05041139-1.24630428 6.10665755-2.88703817 9.16407065-4.3970735 3.05741311-1.53454131 6.12649572-3.44484103 9.18857665-5.19293447a30.14235897 30.14235897 0 0 0-5.18593277-54.67051396l-6.63411965-2.28722507c-20.57685697-2.97455954-40.80246154-6.82666667-60.36407066-12.19464388-19.53126838-5.38081367-38.44171851-12.27049572-55.6285812-21.53492422-17.15768889-9.25859373-32.55444787-20.99695954-43.99174016-35.88609459a100.91096979
                100.91096979 0 0 1-13.93690257-24.49781423 100.78493903 100.78493903 0 0 1-2.58129687-7.38446952c2.70732764 0.93939601 5.36797721 1.96631338 8.11848205 2.76800911a269.45728547 269.45728547 0 0 0 29.45852536 6.90251852 232.34239088 232.34239088 0 0 0 30.7993527 3.49618689c2.63030883 0.18671226 5.43799431 0.1178621 8.1873322 0.14936981 2.71899715 0.07585185 5.68072023-0.16337322 8.58059487-0.31274302 2.82518974-0.0746849 6.10198974-0.62665299 9.21424957-1.02691738 3.09475556-0.38859487 6.87801253-1.45402165 10.31585186-2.29305983 9.565502-2.40508718 17.95938462-9.47681367 21.42989857-19.49275897v-0.00700172a30.2357151 30.2357151 0 0 0-18.68522849-38.45922279l-3.74007977-1.29648319c-2.91737892-1.00941311-6.06348034-2.03633048-9.31344046-3.84627236-3.25812877-1.61039316-6.55826781-3.75174928-9.86540854-6.01330143-6.58394074-4.71681824-13.02317949-10.51073277-19.01780969-16.9814792-12.00793162-12.97883533-22.27360456-28.55063704-30.06067236-45.22520798a181.02569572
                181.02569572 0 0 1-9.76505072-25.84447635 189.8326792 189.8326792 0 0 1-3.30714074-13.39193618 175.15592934 175.15592934 0 0 1-2.14252308-13.57398063 142.93989744 142.93989744 0 0 1-0.92655953-13.66733676 116.6951567 116.6951567 0 0 1-0.01867124-6.28286723c45.49477379 43.71517265 96.60025072 82.41945527 153.42612422 112.35409687a594.00051966 594.00051966 0 0 0 52.47314416 24.49898119 576.21150997 576.21150997 0 0 0 54.86422792 19.26053561 520.92367864 520.92367864 0 0 0 28.15620741 7.55484445 509.26816638 509.26816638 0 0 0 28.53780057 6.13233049 567.15363191 567.15363191 0 0 0 28.8260376 4.70981652c9.64718861 1.35366382 19.33055271 2.37474644 29.02675328 3.31414245a31.69440456 31.69440456
                0 0 0 32.35956695-41.78620171l-0.20655042-0.60681481c-5.11824957-15.06534473-8.43122508-30.36874758-8.8571624-45.38274644-0.52629516-15.00699715 1.55321253-29.70941995 6.34471567-43.50862223 9.43363646-27.62407749 30.10501652-51.52674644 56.50612878-67.23624843 26.30308832-15.80402508 58.09785072-23.39504502 87.8014359-20.45082621 14.83778918 1.44701995 29.08860171 5.50567749 41.82937891 12.11295727 12.76645014 6.59094245 23.97151909 15.76668262 33.27329003 27.01726267l7.3728 6.30737322a24.7615453 24.7615453 0 0 0 23.35770256 4.7296547 709.68159544 709.68159544 0 0 0 30.0478359-10.03578348c4.96771282-1.80294017 9.92142223-3.77625527 14.8517926-5.65621423 4.92920342-1.93480569 9.81406268-4.10183476 14.70125583-6.144 2.7563396-1.18445585 5.49284103-2.4552661 8.22467465-3.74007978a1120.60258462 1120.60258462 0 0 1-22.78239545 41.96824616h-0.00583475a11.62517151 11.62517151 0 0 0 9.27026324 18.9162849l2.32340058-0.05017892 44.3861698-0.95806723a362.47032707 362.47032707 0 0 1-23.82098234 25.22482506z"
                      fill="#2c2c2c" p-id="24631"></path>
            </svg>
        </a></li>


        <li><a href="/tags.html" title="标签">
            <svg t="1664446572405" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="24103" width="20" height="20">
                <path d="M142.56 384a32 32 0 0 1 32-32H896a32 32 0 1 1 0 64H174.56a32 32 0 0 1-32-32z" p-id="24104"
                      fill="#2c2c2c"></path>
                <path d="M709.76 128.544a32 32 0 0 1 25.728 37.216l-128 704a32 32 0 1 1-62.976-11.456l128-704a32 32 0 0 1 37.216-25.76zM453.76 128.544a32 32 0 0 1 25.728 37.216l-128 704a32 32 0 1 1-62.976-11.456l128-704a32 32 0 0 1 37.216-25.76z"
                      p-id="24105" fill="#2c2c2c"></path>
                <path d="M96 640a32 32 0 0 1 32-32h721.472a32 32 0 1 1 0 64H128a32 32 0 0 1-32-32z" p-id="24106"
                      fill="#2c2c2c"></path>
            </svg>
        </a>
        </li>

        <li><a href="/feed.xml" title="RSS订阅">
            <svg t="1664446461115" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="20269" width="20" height="20">
                <path d="M320 832H192v-128c71.04 0 128 56.96 128 128zM192 192v64a576 576 0 0 1 576 576h64C832 478.72 545.28 192 192 192z m0 256v64c176 0 320 144 320 320h64c0-211.84-172.16-384-384-384z"
                      p-id="20270" fill="#2c2c2c"></path>
            </svg>
        </a></li>

        <li><a href="/links.html" title="友情链接">
            <svg t="1664446846305" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="28205" width="20" height="20">
                <path d="M660.107636 356.538182a31.030303 31.030303 0 0 1 0 43.845818l-263.323151 263.323152a31.030303 31.030303 0 0 1-43.876849-43.907879l263.292122-263.292121a31.030303 31.030303 0 0 1 43.907878 0z"
                      fill="#2c2c2c" p-id="28206"></path>
                <path d="M330.969212 422.353455a31.030303 31.030303 0 0 1 0 43.907878L221.246061 575.922424a155.151515 155.151515 0 0 0 219.415272 219.415273l109.723152-109.692121a31.030303 31.030303 0 1 1 43.876848 43.876848l-109.692121 109.692121a217.212121 217.212121 0 0 1-307.2-307.168969l109.723152-109.723152a31.030303 31.030303 0 0 1 43.876848 0zM528.446061 180.968727a217.212121 217.212121 0 0 1 307.2 307.2l-109.692122 109.723152a31.030303 31.030303 0 1 1-43.907878-43.907879l109.723151-109.692121a155.151515 155.151515 0 0 0-219.415273-219.415273l-109.723151 109.692121a31.030303 31.030303 0 0 1-43.876849-43.876848l109.723152-109.723152z"
                      fill="#2c2c2c" p-id="28207"></path>
            </svg>
        </a></li>

        <li><a href="mailto:intbleem@gmail.com" title="邮件">
            <svg t="1664446389922" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="19214" width="20" height="20">
                <path d="M874.666667 181.333333H149.333333c-40.533333 0-74.666667 34.133333-74.666666 74.666667v512c0 40.533333 34.133333 74.666667 74.666666 74.666667h725.333334c40.533333 0 74.666667-34.133333 74.666666-74.666667V256c0-40.533333-34.133333-74.666667-74.666666-74.666667z m-725.333334 64h725.333334c6.4 0 10.666667 4.266667 10.666666 10.666667v25.6L512 516.266667l-373.333333-234.666667V256c0-6.4 4.266667-10.666667 10.666666-10.666667z m725.333334 533.333334H149.333333c-6.4 0-10.666667-4.266667-10.666666-10.666667V356.266667l356.266666 224c4.266667 4.266667 10.666667 4.266667 17.066667 4.266666s12.8-2.133333 17.066667-4.266666l356.266666-224V768c0 6.4-4.266667 10.666667-10.666666 10.666667z"
                      p-id="19215" fill="#2c2c2c"></path>
            </svg>
        </a></li>

    </ul>
    <hr>
</nav>



<main>
    
    <div class="header-line"></div>
    <div class="article-meta">
        <h1 class="title">科学有效的上网方法</h1>
        <div class="article-attrs">
            <div class="article-detail-date">
                <time>Jul 15, 2022</time>
            </div>

            <div class="article-tags">
                <ul>
                    
                        <li>
                            <a href="/tag/V2Ray.html"># V2Ray</a>
                        </li>
                    
                        <li>
                            <a href="/tag/Vmess.html"># Vmess</a>
                        </li>
                    
                        <li>
                            <a href="/tag/tls.html"># tls</a>
                        </li>
                    
                </ul>
            </div>

        </div>
    </div>

    <div class="article-body">
        <p>看这这个挺高大上的标题，好像就像是标题党一样，其实真正的标题用正常人的话来说，就是如何科学的上网，只不过生活在大陆这个环境下，已经习惯了用各种隐晦的词来描述某些东西。算了，标题党就标题党吧。</p>
<p>写这篇的主要原因也是因为最近腾讯云把我的一个香港服务器给封禁了，理由也是意料之中的「存在通过技术手段使其成为跨境访问节点等行为」，刚开始还以为是先发出警告，等我连接服务器的时候发现直接是把服务器给封掉了，连22端口都没得用。幸亏部署的服务都是静态方式存储的，而且大多数还都有备份，这要是没有备份的话，真的要气死人了。</p>
<p>没办法只好重新搞一台服务器了，不过这次选用的国外的服务器，服务器拿到手就直接通过脚本部署了一套SSR，刚用了几个小时就被Q了，切换IP同样操作之后还是没过多久就又不行了，于是尝试更换方案，经过了解尝试使用V2Ray+websocket+tls+web的方式来构建服务。</p>
<p>V2Ray+websocket+tls+web是目前最稳定的翻Q技术之一，即使在敏感时期也稳如泰山。和SSR的流量混淆不同，V2Ray+ws+tls用真正的https流量FQ，没有必要做任何混淆。在长城看来，流量和不计其数的https流量没有任何区别。但是如果GFW尝试主动嗅探的话，发现流量的目的地没有真正的网站，从而被识破然后被Q。所以要在这个服务外面加一个真正的网站做掩护，从而假装是访问真正的网站。</p>
<h2>Cloudflare配置DNS</h2>
<p>这次部署过程中，使用的是Cloudflare作为DNS服务器，Cloudflare是世界上最大的CDN提供商，全球半数的网站都在使用Cloudflare。使用不用担心隐私泄露或钓鱼风险，而且也可以提供免费的CDN服务，只不过对于国内来说，访问速度可能会慢一点。</p>
<p><img data-src="https://static.19961002.xyz/img/2022/jFu3MfCB.png" src="https://static.19961002.xyz/img/2022/jFu3MfCB.png" /></p>
<ul>
<li>DNS类型为A类型</li>
<li>名称为要解析的域名地址，可以顶级，也可以是二级域名</li>
<li>内容就是要解析的IP地址</li>
<li>代理状态为「仅限DNS」，注意小云朵是灰色</li>
</ul>
<p>配置完成之后可以使用 <strong>ping</strong>命令测试是否可以ping通，如果可以，那就说明配置没问题。</p>
<h2>V2Ray安装和配置</h2>
<p>网上已经有很多一键安装脚本，这里选用的是 <a href="https://github.com/v2fly/fhs-install-v2ray/blob/master/README.zh-Hans-CN.md">https://github.com/v2fly/fhs-install-v2ray</a>，此脚本需要在root用户下运行，并且会安装如下文件：</p>
<div class="codehilite"><pre><span></span><code><span class="n">installed</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">v2ray</span>
<span class="n">installed</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">v2ctl</span>
<span class="n">installed</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">v2ray</span><span class="o">/</span><span class="n">geoip</span><span class="o">.</span><span class="n">dat</span>
<span class="n">installed</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">v2ray</span><span class="o">/</span><span class="n">geosite</span><span class="o">.</span><span class="n">dat</span>
<span class="n">installed</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">v2ray</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">json</span>
<span class="n">installed</span><span class="p">:</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">v2ray</span><span class="o">/</span>
<span class="n">installed</span><span class="p">:</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">v2ray</span><span class="o">/</span><span class="n">access</span><span class="o">.</span><span class="n">log</span>
<span class="n">installed</span><span class="p">:</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">v2ray</span><span class="o">/</span><span class="n">error</span><span class="o">.</span><span class="n">log</span>
<span class="n">installed</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">v2ray</span><span class="o">.</span><span class="n">service</span>
<span class="n">installed</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">v2ray</span><span class="err">@</span><span class="o">.</span><span class="n">service</span>
</code></pre></div>


<p>此脚本会配置自动运行脚本。自动运行脚本会在系统重启之后，自动运行 V2Ray。目前自动运行脚本只支持带有 Systemd 的系统，以及 Debian / Ubuntu 全系列。</p>
<p>其中路径<code>/usr/local/etc/v2ray/config.json</code>就是配置文件的路径，安装完成之后只用修改这个文件即可。</p>
<p>关于V2Ray的配置网上已经有很多，我们只需要下载一个，其中需要修改的地方改成我们自己的即可。可以参考我的配置：</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;inbound&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;vmess&quot;</span><span class="p">,</span>
        <span class="nt">&quot;listen&quot;</span><span class="p">:</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="mi">8080</span><span class="p">,</span>
        <span class="nt">&quot;settings&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;clients&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;◆◆◆◆◆◆◆◆◆◆◆◆&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;afterId&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;streamSettings&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;network&quot;</span><span class="p">:</span> <span class="s2">&quot;ws&quot;</span><span class="p">,</span>
            <span class="nt">&quot;wsSettings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/★★★★★★★★★★★★&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;outbound&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;freedom&quot;</span><span class="p">,</span>
    <span class="nt">&quot;ip&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;geoip:provate&quot;</span><span class="p">],</span>
    <span class="nt">&quot;outboundTag&quot;</span><span class="p">:</span> <span class="s2">&quot;blocked&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>在这个配置文件中，需要将标记的信息换成自己的即可：</p>
<p>"◆◆◆◆◆◆◆◆◆◆◆◆"：uuid，自己生成或者通过在线网站生成，例如：<code>63c0042a-4a85-4d03-a488-3ba383142461</code></p>
<p>"★★★★★★★★★★★★"：这个地方填写的则是一个随机字符串，越没有规律越好，越乱越好，可以在键盘上胡乱打一串或者程序生成。其实这个字符串就是websocket路径，在配置客户端的时候需要用到。</p>
<h2>Nginx配置反代</h2>
<p>因为上面已经配置了DNS的解析服务，而且也不适合直接用IP，所以这时候就需要用Nginx来代理websocket，配置文件内容如下：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">server</span> <span class="p">{</span>
    <span class="err">###</span> <span class="err">1:</span>
    <span class="err">server_name</span> <span class="err">●●●●●●●●●●●●</span><span class="p">;</span>

    <span class="err">listen</span> <span class="err">80</span> <span class="err">reuseport</span> <span class="err">fastopen=10</span><span class="p">;</span>
    <span class="err">rewrite</span> <span class="err">^(.*)</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="err">$</span><span class="n">server_name</span><span class="err">$</span><span class="mi">1</span> <span class="n">permanent</span><span class="p">;</span>
    <span class="err">if</span> <span class="err">($request_method</span>  <span class="err">!~</span> <span class="err">^(POST|GET)$)</span> <span class="err">{</span> <span class="err">return</span>  <span class="err">501</span><span class="p">;</span> <span class="p">}</span>
    <span class="nt">autoindex</span> <span class="nt">off</span><span class="o">;</span>
    <span class="nt">server_tokens</span> <span class="nt">off</span><span class="o">;</span>
<span class="err">}</span>

<span class="nt">server</span> <span class="p">{</span>
    <span class="err">###</span> <span class="err">2:</span>
    <span class="err">ssl_certificate</span> <span class="err">/etc/letsencrypt/live/●●●●●●●●●●●●/fullchain.pem</span><span class="p">;</span>

    <span class="err">###</span> <span class="err">3:</span>
    <span class="err">ssl_certificate_key</span> <span class="err">/etc/letsencrypt/live/●●●●●●●●●●●●/privkey.pem</span><span class="p">;</span>

    <span class="err">###</span> <span class="err">4:</span>
    <span class="err">location</span> <span class="err">/★★★★★★★★★★★★</span>
    <span class="err">{</span>
        <span class="err">proxy_pass</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">8964</span><span class="p">;</span>
        <span class="err">proxy_redirect</span> <span class="err">off</span><span class="p">;</span>
        <span class="err">proxy_http_version</span> <span class="err">1.1</span><span class="p">;</span>
        <span class="err">proxy_set_header</span> <span class="err">Upgrade</span> <span class="err">$http_upgrade</span><span class="p">;</span>
        <span class="err">proxy_set_header</span> <span class="err">Connection</span> <span class="err">&quot;upgrade&quot;</span><span class="p">;</span>
        <span class="err">proxy_set_header</span> <span class="err">Host</span> <span class="err">$host</span><span class="p">;</span>

        <span class="err">sendfile</span> <span class="err">on</span><span class="p">;</span>
        <span class="err">tcp_nopush</span> <span class="err">on</span><span class="p">;</span>
        <span class="err">tcp_nodelay</span> <span class="err">on</span><span class="p">;</span>
        <span class="err">keepalive_requests</span> <span class="err">10000</span><span class="p">;</span>
        <span class="err">keepalive_timeout</span> <span class="err">2h</span><span class="p">;</span>
        <span class="err">proxy_buffering</span> <span class="err">off</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nt">listen</span> <span class="nt">443</span> <span class="nt">ssl</span> <span class="nt">reuseport</span> <span class="nt">fastopen</span><span class="o">=</span><span class="nt">10</span><span class="o">;</span>
    <span class="nt">server_name</span> <span class="o">$</span><span class="nt">server_name</span><span class="o">;</span>
    <span class="nt">charset</span> <span class="nt">utf-8</span><span class="o">;</span>

    <span class="nt">sendfile</span> <span class="nt">on</span><span class="o">;</span>
    <span class="nt">tcp_nopush</span> <span class="nt">on</span><span class="o">;</span>
    <span class="nt">tcp_nodelay</span> <span class="nt">on</span><span class="o">;</span>
    <span class="nt">keepalive_requests</span> <span class="nt">10000</span><span class="o">;</span>
    <span class="nt">keepalive_timeout</span> <span class="nt">2h</span><span class="o">;</span>

    <span class="nt">ssl_protocols</span> <span class="nt">TLSv1</span><span class="p">.</span><span class="nc">2</span> <span class="nt">TLSv1</span><span class="p">.</span><span class="nc">3</span><span class="o">;</span>
    <span class="nt">ssl_ciphers</span> <span class="nt">TLS13-CHACHA20-POLY1305-SHA256</span><span class="p">:</span><span class="nd">TLS13-AES-128-GCM-SHA256</span><span class="p">:</span><span class="nd">TLS13-AES-256-GCM-SHA384</span><span class="p">:</span><span class="nd">ECDHE-ECDSA-AES128-GCM-SHA256</span><span class="p">:</span><span class="nd">ECDHE-RSA-AES128-GCM-SHA256</span><span class="p">:</span><span class="nd">ECDHE-ECDSA-AES256-GCM-SHA384</span><span class="p">:</span><span class="nd">ECDHE-RSA-AES256-GCM-SHA384</span><span class="p">:</span><span class="nd">ECDHE-ECDSA-CHACHA20-POLY1305</span><span class="p">:</span><span class="nd">ECDHE-RSA-CHACHA20-POLY1305</span><span class="p">:</span><span class="nd">DHE-RSA-AES128-GCM-SHA256</span><span class="p">:</span><span class="nd">DHE-RSA-AES256-GCM-SHA384</span><span class="o">;</span>
    <span class="nt">ssl_ecdh_curve</span> <span class="nt">secp384r1</span><span class="o">;</span>
    <span class="nt">ssl_prefer_server_ciphers</span> <span class="nt">off</span><span class="o">;</span>

    <span class="nt">ssl_session_cache</span> <span class="nt">shared</span><span class="p">:</span><span class="nd">SSL</span><span class="p">:</span><span class="nd">60m</span><span class="o">;</span>
    <span class="nt">ssl_session_timeout</span> <span class="nt">1d</span><span class="o">;</span>
    <span class="nt">ssl_session_tickets</span> <span class="nt">off</span><span class="o">;</span>
    <span class="nt">ssl_stapling</span> <span class="nt">on</span><span class="o">;</span>
    <span class="nt">ssl_stapling_verify</span> <span class="nt">on</span><span class="o">;</span>
    <span class="nt">resolver</span> <span class="nt">8</span><span class="p">.</span><span class="nc">8</span><span class="p">.</span><span class="nc">8</span><span class="p">.</span><span class="nc">8</span> <span class="nt">8</span><span class="p">.</span><span class="nc">8</span><span class="p">.</span><span class="nc">4</span><span class="p">.</span><span class="nc">4</span> <span class="nt">valid</span><span class="o">=</span><span class="nt">300s</span><span class="o">;</span>
    <span class="nt">resolver_timeout</span> <span class="nt">10s</span><span class="o">;</span>

    <span class="nt">if</span> <span class="o">($</span><span class="nt">request_method</span>  <span class="o">!~</span> <span class="o">^(</span><span class="nt">POST</span><span class="o">|</span><span class="nt">GET</span><span class="o">)$)</span> <span class="p">{</span> <span class="err">return</span> <span class="err">501</span><span class="p">;</span> <span class="p">}</span>
    <span class="nt">add_header</span> <span class="nt">X-Frame-Options</span> <span class="nt">DENY</span><span class="o">;</span>
    <span class="nt">add_header</span> <span class="nt">X-XSS-Protection</span> <span class="s2">&quot;1; mode=block&quot;</span><span class="o">;</span>
    <span class="nt">add_header</span> <span class="nt">X-Content-Type-Options</span> <span class="nt">nosniff</span><span class="o">;</span>
    <span class="nt">add_header</span> <span class="nt">Strict-Transport-Security</span> <span class="nt">max-age</span><span class="o">=</span><span class="nt">31536000</span> <span class="nt">always</span><span class="o">;</span>
    <span class="nt">autoindex</span> <span class="nt">off</span><span class="o">;</span>
    <span class="nt">server_tokens</span> <span class="nt">off</span><span class="o">;</span>

    <span class="nt">index</span> <span class="nt">index</span><span class="p">.</span><span class="nc">html</span> <span class="nt">index</span><span class="p">.</span><span class="nc">htm</span>  <span class="nt">index</span><span class="p">.</span><span class="nc">php</span><span class="o">;</span>
    <span class="nt">location</span> <span class="o">~</span> <span class="o">.*</span><span class="err">\</span><span class="o">.(</span><span class="nt">js</span><span class="o">|</span><span class="nt">jpg</span><span class="o">|</span><span class="nt">JPG</span><span class="o">|</span><span class="nt">jpeg</span><span class="o">|</span><span class="nt">JPEG</span><span class="o">|</span><span class="nt">css</span><span class="o">|</span><span class="nt">bmp</span><span class="o">|</span><span class="nt">gif</span><span class="o">|</span><span class="nt">GIF</span><span class="o">|</span><span class="nt">png</span><span class="o">)$</span> <span class="p">{</span> <span class="err">access_log</span> <span class="err">off</span><span class="p">;</span> <span class="p">}</span>
    <span class="nt">location</span> <span class="o">/</span> <span class="p">{</span> <span class="err">index</span> <span class="err">index.html</span><span class="p">;</span> <span class="p">}</span>
<span class="err">}</span>
</code></pre></div>


<p>看上去很长，实际上只有四处需要填写，配置文件里用#1，#2，#3，#4标出了位置，把标符号的地方换成你自己的信息。</p>
<p>●●●●●●●●●●●●：标注“●”的地方填写域名，<strong>注意这里的域名带www</strong></p>
<p>★★★★★★★★★★★★：标注“★”的地方填写一个随机字符串，这个随机字符串必须和V2Ray配置中的一样，不然无法工作。注意不要删掉前面的斜杠。</p>
<p>最后，把Nginx的配置文件另存为default.conf（注意扩展名就是.conf），放在<code>/etc/nginx/conf.d/</code>下。</p>
<h2>配置SSL证书</h2>
<p>为了用真正的https流量翻墙，网站就必须有合法的SSL证书。可以用自动化工具Certbot申请证书，只要把以下命令复制到命令窗口，依次执行即可。</p>
<p>这里说的“证书”，实际指的是“数字证书”。当然申请完全是免费的，申请时需要邮箱地址。如有必要，可以使用匿名邮箱。</p>
<h3>安装certbot</h3>
<p>由于服务器系统自带的Python环境是v3.7，但是没有安装pip，所以首先安装pip工具。</p>
<div class="codehilite"><pre><span></span><code>apt install python3-pip
</code></pre></div>


<p>安装好pip之后即可安装certbot</p>
<div class="codehilite"><pre><span></span><code>pip3 install certbot
</code></pre></div>


<p>生成证书</p>
<div class="codehilite"><pre><span></span><code>certbot certonly --standalone --agree-tos -n -d www.●●●●●●●●●●●● -d ●●●●●●●●●●●● -m ●●●●●●●●●●●●@●●●●●●●●●●●●
</code></pre></div>


<p>第一个-d加一个带www的域名，第二个-d加一个不带www的域名，-m后面加你的电子邮箱。注意前后要带空格。</p>
<p>运行这条命令后，如果显示：</p>
<div class="codehilite"><pre><span></span><code><span class="n">IMPORTANT</span> <span class="nl">NOTES:</span>

<span class="o">-</span> <span class="n">Congratulations</span><span class="o">!</span> <span class="n">Your</span> <span class="n">certificate</span> <span class="k">and</span> <span class="n">chain</span> <span class="n">have</span> <span class="n">been</span> <span class="n">saved</span> <span class="nl">at:</span>
  <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">letsencrypt</span><span class="o">/</span><span class="n">live</span><span class="o">/</span><span class="n">www</span><span class="p">.</span><span class="n">hrw1rdzqa7c5a8u3ibkn</span><span class="p">.</span><span class="n">website</span><span class="o">/</span><span class="n">fullchain</span><span class="p">.</span><span class="n">pem</span>
  <span class="n">Your</span> <span class="n">key</span> <span class="n">file</span> <span class="n">has</span> <span class="n">been</span> <span class="n">saved</span> <span class="nl">at:</span>
  <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">letsencrypt</span><span class="o">/</span><span class="n">live</span><span class="o">/</span><span class="n">www</span><span class="p">.</span><span class="n">hrw1rdzqa7c5a8u3ibkn</span><span class="p">.</span><span class="n">website</span><span class="o">/</span><span class="n">privkey</span><span class="p">.</span><span class="n">pem</span>
  <span class="n">Your</span> <span class="n">cert</span> <span class="n">will</span> <span class="n">expire</span> <span class="n">on</span> <span class="mh">2020</span><span class="o">-</span><span class="mh">06</span><span class="o">-</span><span class="mf">04.</span> <span class="n">To</span> <span class="n">obtain</span> <span class="n">a</span> <span class="n">new</span> <span class="k">or</span> <span class="n">tweaked</span>
  <span class="n">version</span> <span class="n">of</span> <span class="n">this</span> <span class="n">certificate</span> <span class="n">in</span> <span class="n">the</span> <span class="n">future</span><span class="p">,</span> <span class="n">simply</span> <span class="n">run</span> <span class="n">certbot</span>
  <span class="n">again</span><span class="p">.</span> <span class="n">To</span> <span class="n">non</span><span class="o">-</span><span class="n">interactively</span> <span class="n">renew</span> <span class="o">*</span><span class="n">all</span><span class="o">*</span> <span class="n">of</span> <span class="n">your</span> <span class="n">certificates</span><span class="p">,</span> <span class="n">run</span>
  <span class="s">&quot;certbot renew&quot;</span>

<span class="o">-</span> <span class="n">Your</span> <span class="n">account</span> <span class="n">credentials</span> <span class="n">have</span> <span class="n">been</span> <span class="n">saved</span> <span class="n">in</span> <span class="n">your</span> <span class="n">Certbot</span>
  <span class="n">configuration</span> <span class="n">directory</span> <span class="n">at</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">letsencrypt</span><span class="p">.</span> <span class="n">You</span> <span class="n">should</span> <span class="n">make</span> <span class="n">a</span>
  <span class="n">secure</span> <span class="n">backup</span> <span class="n">of</span> <span class="n">this</span> <span class="n">folder</span> <span class="n">now</span><span class="p">.</span> <span class="n">This</span> <span class="n">configuration</span> <span class="n">directory</span> <span class="n">will</span>
  <span class="n">also</span> <span class="n">contain</span> <span class="n">certificates</span> <span class="k">and</span> <span class="n">private</span> <span class="n">keys</span> <span class="n">obtained</span> <span class="n">by</span> <span class="n">Certbot</span> <span class="n">so</span>
  <span class="n">making</span> <span class="n">regular</span> <span class="n">backups</span> <span class="n">of</span> <span class="n">this</span> <span class="n">folder</span> <span class="n">is</span> <span class="n">ideal</span><span class="p">.</span>

<span class="o">-</span> <span class="n">If</span> <span class="n">you</span> <span class="n">like</span> <span class="n">Certbot</span><span class="p">,</span> <span class="n">please</span> <span class="n">consider</span> <span class="n">supporting</span> <span class="n">our</span> <span class="n">work</span> <span class="nl">by:</span>

  <span class="n">Donating</span> <span class="n">to</span> <span class="n">ISRG</span> <span class="o">/</span> <span class="n">Let</span><span class="p">&#39;</span><span class="n">s</span> <span class="nl">Encrypt:</span>  <span class="nl">https:</span><span class="c1">//letsencrypt.org/donate</span>
  <span class="n">Donating</span> <span class="n">to</span> <span class="nl">EFF:</span>                    <span class="nl">https:</span><span class="c1">//eff.org</span>
</code></pre></div>


<p>表示证书生成成功。</p>
<p>注意：在生成证书的时候容易出现问题，就比如我在生成证书的时候就出现如下错误：</p>
<div class="codehilite"><pre><span></span><code>x86_64-linux-gnu-gcc -pthread -DNDEBUG -g -fwrapv -O2 -Wall -Wstrict-prototypes -fno-strict-aliasing -Wdate-time -D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span> -g -fdebug-prefix-map<span class="o">=</span>/build/python2.7-PPrPZj/python2.7-2.7.15<span class="o">=</span>. -fstack-protector-strong -Wformat -Werror<span class="o">=</span>format-security -fPIC -DUSE__THREAD -DHAVE_SYNC_SYNCHRONIZE -I/usr/include/ffi -I/usr/include/libffi -I/usr/include/python2.7 -c c/_cffi_backend.c -o build/temp.linux-x86_64-2.7/c/_cffi_backend.o
  c/_cffi_backend.c:15:10: fatal error: ffi.h: No such file or directory
   <span class="c1">#include &lt;ffi.h&gt;</span>
            ^~~~~~~
  compilation terminated.
  error: <span class="nb">command</span> <span class="s1">&#39;x86_64-linux-gnu-gcc&#39;</span> failed with <span class="nb">exit</span> status <span class="m">1</span>
</code></pre></div>


<p>解决办法是安装相关依赖即可。</p>
<div class="codehilite"><pre><span></span><code>apt install libffi-dev
</code></pre></div>


<p>同样的因为这个问题导致的<code>cryptography</code>和<code>pyopenssl</code>版本问题，也可以通过<strong>升级安装包</strong>解决。</p>
<p>另外通过这种方式生成的证书时限只有三个月，所以我们通过定时任务，让他自从申请证书，从而达到证书的 <strong>自动续命</strong> 。</p>
<div class="codehilite"><pre><span></span><code><span class="nb">echo</span> <span class="s2">&quot;0 0 1 */2 * service nginx stop; certbot renew; service nginx start;&quot;</span> <span class="p">|</span> crontab
</code></pre></div>


<h2>启动服务</h2>
<p>测试V2Ray配置是否正常</p>
<div class="codehilite"><pre><span></span><code>/usr/local/bin/v2ray -test -config<span class="o">=</span>/usr/local/etc/v2ray/config.json
</code></pre></div>


<p>如果显示：</p>
<div class="codehilite"><pre><span></span><code><span class="nv">V2Ray</span> <span class="mi">4</span>.<span class="nv">x</span>.<span class="nv">x</span> <span class="ss">(</span><span class="nv">V2Fly</span>, <span class="nv">a</span> <span class="nv">community</span><span class="o">-</span><span class="nv">driven</span> <span class="nv">edition</span> <span class="nv">of</span> <span class="nv">V2Ray</span>.<span class="ss">)</span>
<span class="nv">A</span> <span class="nv">unified</span> <span class="nv">platform</span> <span class="k">for</span> <span class="nv">anti</span><span class="o">-</span><span class="nv">censorship</span>.
<span class="nv">Configuration</span> <span class="nv">OK</span>.
</code></pre></div>


<p>测试nginx配置是否正常</p>
<div class="codehilite"><pre><span></span><code>nginx -t
</code></pre></div>


<p>如果显示：</p>
<div class="codehilite"><pre><span></span><code><span class="n">nginx</span><span class="o">:</span> <span class="n">the</span> <span class="n">configuration</span> <span class="n">file</span> <span class="sr">/etc/nginx/</span><span class="n">ngin短网址nf</span> <span class="n">syntax</span> <span class="k">is</span> <span class="n">ok</span>
<span class="n">nginx</span><span class="o">:</span> <span class="n">configuration</span> <span class="n">file</span> <span class="sr">/etc/nginx/</span><span class="n">ngin短网址nf</span> <span class="n">test</span> <span class="k">is</span> <span class="n">successful</span>
</code></pre></div>


<p>说明配置没有问题。</p>
<p>测试V2Ray和Nginx配置正常之后即可启动服务了。启动服务通过<code>service</code>命令启动</p>
<p>启动V2Ray：</p>
<div class="codehilite"><pre><span></span><code>service v2ray start
</code></pre></div>


<p>启动Nginx</p>
<div class="codehilite"><pre><span></span><code>service nginx start
</code></pre></div>


<p>配置完成后，可以在浏览器里输入网址，如果显示Nginx的欢迎页面，就说明网址配置成功了！
接下来要做的是上传一个网页模板，这样别人访问你的服务器就会看到一个真的网站。</p>
<p>在网上找一些静态网页模版，放在目录<code>/usr/share/nginx/html/</code>下即可，最好是找一些全英文的网站，存在中文的话可能会增加一些被墙的概率。</p>
<h2>客户端配置</h2>
<p>这里使用的客户端是著名的代理软件Shadowsockets（小火箭），这是一款iOS生态下全平台通用的一款软件，配置也相对简单。</p>
<p><img data-src="https://static.19961002.xyz/img/2022/XUEexvP4.png" src="https://static.19961002.xyz/img/2022/XUEexvP4.png" /></p>
<p>点【服务器】按钮，选择【添加VMess】服务器。</p>
<ul>
<li>地址：域名地址，当然也可以IP地址</li>
<li>端口：443</li>
<li>UUID：就是上面说的V2Ray配置文件里的UUID</li>
<li>额外ID：0，最新的V2Ray版本已经强制为0，至于原因可以自行Google</li>
<li>算法：随便选。</li>
<li>传输方式：选WebSocket；Host：域名地址；路径：即前面的随机字符串，注意前面必须要加上斜杠“/”</li>
</ul>
<p><img data-src="https://static.19961002.xyz/img/2022/image-20220720124353424.png" src="https://static.19961002.xyz/img/2022/image-20220720124353424.png" /></p>
<ul>
<li>别名：随便填。</li>
<li>TLS：打开</li>
</ul>
<p>到这里基本上就算完成了，当然还有一些其他优化项，比如：</p>
<ul>
<li>CDN隐藏域名IP</li>
<li>BBR加速（debian10以上自动开启）</li>
<li>配置防火墙</li>
</ul>
<p>想要了解的可以自行Google，我太懒了，也没有做这些配置，就不一一赘述了，逃。</p>
<p>参考链接：<a href="https://pincong.rocks/article/15493">https://pincong.rocks/article/15493</a></p>
    </div>

    
    
    

</main>

<footer>
    &copy; 2020-2022 ·
    <a href="/sitemap.xml">Sitemap</a> ·
    
    
    Powered by <a href="https://github.com/Cocojcc/zogn">zogn</a>
</footer>


</body>
</html>