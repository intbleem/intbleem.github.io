<!doctype html>
<html lang="zh-Hans">
<head>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="always">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="google-site-verification" content="m9HzlxEFMjeLY1dz5g98y0-93U1BVLaGlv_D4c984PI"/>
    <link rel="profile" href="http://gmpg.org/xfn/11"/>

    
    <title>Elasticsearch相关汇总 | 2Dosth</title>
    <meta name="description" content=""/>
    <meta name="keywords" content="Elasticsearch,技术笔记"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Elasticsearch相关汇总"/>
    <meta property="og:description" content=""/>


    <meta property="og:locale" content="zh-Hans">


    <link href="https://fonts.googleapis.com/css2?family=Playball&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/static/css/style.css" type="text/css">
    <link rel="stylesheet" href="/static/css/code.css" type="text/css">
    
        <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c7f70ec56346e1ef095ec0104e479a46";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


    
</head>

<body data-new-gr-c-s-check-loaded="14.991.0">

<nav>
    <div class="site-name"><a href="/">2Dosth</a></div>
    <ul class="menu">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        <li><a href="https://twitter.com/OnePieceOwner" title="Twitter">
            <svg t="1664500269647" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="2003" width="20" height="20">
                <path d="M868.78260513 350.93851167c-4.19752479 316.58112364-206.64378348 533.42289687-508.84923077 547.04005471-124.62575954 5.70639316-214.91280228-34.551102-293.48715213-84.46745527 92.10982108 14.70125585 206.32520569-22.11723305 267.41045242-74.40833277-90.28704274-8.78247749-143.74276011-54.7393641-168.7552-128.69725356 26.08953618 4.51026781 53.57474644 3.31414245 78.36079771-1.93480569-81.47305755-27.27282508-139.65259487-77.62795213-142.6586621-183.14254588 22.8629151 10.40920798 46.6967339 20.19409687 78.36079772 22.12306782-60.97321937-34.68180056-106.05956011-161.46291966-54.42078633-245.29788718 90.49359316 99.18854928 199.34683533 180.12947692 378.08647293 191.07898346-44.87512251-191.83050029 209.33127293-295.85489687 315.7222473-166.92541994 44.97431338-8.70079088 81.58158405-25.7639567 116.79551453-44.33599088-14.49353846 44.54837607-42.40585299 75.68030997-76.43065983 100.58539031 37.3506188-5.04239772 70.41152364-14.16912593 98.65525243-28.12469971-17.51944388 36.39255157-55.82929687 69.02751909-88.78984388 96.50689458z"
                      fill="#2c2c2c" p-id="2004"></path>
            </svg>
        </a></li>


        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        <li><a href="mailto:intbleem@gmail.com" title="邮件">
            <svg t="1664500756779" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="15481" width="20" height="20">
                <path d="M853.333333 170.666667 170.666667 170.666667C123.733333 170.666667 85.333333 209.066667 85.333333 256l0 512c0 46.933333 38.4 85.333333 85.333333 85.333333l682.666667 0c46.933333 0 85.333333-38.4 85.333333-85.333333L938.666667 256C938.666667 209.066667 900.266667 170.666667 853.333333 170.666667zM853.333333 341.333333l-341.333333 213.333333L170.666667 341.333333 170.666667 256l341.333333 213.333333 341.333333-213.333333L853.333333 341.333333z"
                      p-id="15482" fill="#2c2c2c"></path>
            </svg>
        </a></li>


        
        
        
        
        
        
        
        
        

        <li><a href="/links.html" title="友情链接">
            <svg t="1664502347383" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="60354" width="20" height="20">
                <path d="M510.3 63.8c-247.4 0-448 200.6-448 448s200.6 448 448 448 448-200.6 448-448-200.5-448-448-448z m183.6 645.6c-20.5 20.5-47.3 30.7-74.2 30.7-26.9 0-53.7-10.2-74.2-30.7l-85.9-85.9c-19.8-19.8-30.7-46.1-30.7-74.2 0-11.8 2-23.2 5.7-34-1.4 2.4-3 4.8-5 6.8-12 12-31.5 12-43.4 0l-59.5-59.5c-19.8-19.8-30.7-46.1-30.7-74.2s10.9-54.4 30.7-74.2c19.8-19.8 46.1-30.7 74.2-30.7s54.4 10.9 74.2 30.7l85.9 85.9c29.2 29.2 37.5 71.6 24.9 108.3 1.4-2.5 3-4.9 5.1-6.9 11.6-11.6 31.8-11.6 43.4 0l59.5 59.5c40.9 40.9 40.9 107.5 0 148.4z"
                      p-id="60355" fill="#2c2c2c"></path>
                <path d="M591 544.9c-5.8-5.8-9-13.5-9-21.7 0-2.2 0.3-4.4 0.8-6.6-5.1 11.6-12.3 22.4-21.7 31.9-6.2 6.2-13.2 11.6-20.7 16-4.8 2.8-10.1 4.3-15.6 4.3-2.6 0-5.1-0.3-7.7-1-7.9-2-14.6-7-18.8-14.1-4.4-7.5-5.2-16.1-3.1-23.8-8.2 16.3-5.7 36.6 7.9 50.2L589 666c16.4 16.4 45.1 16.4 61.5 0 17-17 17-44.5 0-61.5L591 544.9zM503.6 455.8c8 2 14.6 7.1 18.8 14.1 4.2 7 5.4 15.3 3.3 23.3 0 0.1-0.1 0.2-0.1 0.3 8-16.3 5.4-36.4-8.1-49.9l-85.9-85.9c-17-17-44.6-17-61.5 0-17 17-17 44.6 0 61.5l59.5 59.5c5.8 5.8 9 13.5 9 21.7 0 2.2-0.3 4.3-0.7 6.4 5.2-11.6 12.4-22.4 21.7-31.6 6.2-6.2 13.1-11.6 20.7-16 7.1-4.3 15.4-5.5 23.3-3.4z"
                      p-id="60356" fill="#2c2c2c"></path>
            </svg>
        </a></li>

        
        
        
        
        
        
        

        <li><a href="/feed.xml" title="RSS订阅">
            <svg t="1664502489548" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 p-id="69131" width="20" height="20">
                <path d="M213.333333 128 810.666667 128C857.6 128 896 166.4 896 213.333333L896 810.666667C896 857.6 857.6 896 810.666667 896L213.333333 896C166.4 896 128 857.6 128 810.666667L128 213.333333C128 166.4 166.4 128 213.333333 128M320 640C284.586667 640 256 668.586667 256 704 256 739.413333 284.586667 768 320 768 355.413333 768 384 739.413333 384 704 384 668.586667 355.413333 640 320 640M256 426.666667 256 512C397.226667 512 512 626.773333 512 768L597.333333 768C597.333333 579.413333 444.586667 426.666667 256 426.666667M256 256 256 341.333333C491.52 341.333333 682.666667 532.48 682.666667 768L768 768C768 485.12 538.88 256 256 256Z"
                      p-id="69132" fill="#2c2c2c"></path>
            </svg>
        </a></li>


    </ul>
    <hr>
</nav>



<main>
    
    <div class="header-line"></div>
    <div class="article-meta">
        <h1 class="title">Elasticsearch相关汇总</h1>

    </div>

    <div class="article-body">
        <p>在使用Elasticsearch的过程中，难免会要去官网翻看文档，由于目前还没有读完文档，以至于在找一些没用过的API时还挺费劲，有时候甚至还可能找不到。因此就把目前已经用到过的地方在这里汇总记录一下，方便以后碰到的话可以直接去查看。</p>
<h2>Index</h2>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/indices.html#index-management">https://www.elastic.co/guide/en/elasticsearch/reference/7.16/indices.html#index-management</a></li>
</ul>
<h2>Aliases</h2>
<p>索引的一个别名，在某些情况下非常有用，比如在无缝切换索引的时候。</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/aliases.html#aliases">https://www.elastic.co/guide/en/elasticsearch/reference/7.16/aliases.html#aliases</a></li>
</ul>
<h2>Mappings</h2>
<p>索引的mapping定义十分重要，他决定了我们的数据是如何保存在索引内，以及保存的数据都有什么字段，各个字段的数据类型又是什么。</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/mapping.html#mapping">https://www.elastic.co/guide/en/elasticsearch/reference/7.16/mapping.html#mapping</a></li>
</ul>
<h2>Setting</h2>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/index-modules.html#index-modules-settings">https://www.elastic.co/guide/en/elasticsearch/reference/7.16/index-modules.html#index-modules-settings</a></li>
</ul>
<h2>Query</h2>
<h3>Full text queries</h3>
<p>全文检索相关，主要包含<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-match-query.html">match query</a>、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-match-bool-prefix-query.html">match_bool_prefix query</a>、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-match-query-phrase.html">match_phrase query</a>、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-match-query-phrase-prefix.html">match_phrase_prefix query</a>、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-multi-match-query.html">multi_match query</a>、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-query-string-query.html">query_string query</a>、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-match-bool-prefix-query.html">match_bool_prefix query</a>、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-match-query-phrase.html">match_phrase query</a>、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-match-query-phrase-prefix.html">match_phrase_prefix query</a>、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-multi-match-query.html">multi_match query</a>、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-query-string-query.html">query_string query</a>等</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/full-text-queries.html#full-text-queries">https://www.elastic.co/guide/en/elasticsearch/reference/7.16/full-text-queries.html#full-text-queries</a></li>
</ul>
<h3>Compound queries</h3>
<p>混合索引，包含<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-bool-query.html">bool query</a>、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-boosting-query.html">boosting query</a>、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-constant-score-query.html">constant_score query</a>、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-dis-max-query.html">dis_max query</a>、<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-function-score-query.html">function_score query</a></p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/compound-queries.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.16/compound-queries.html</a></li>
</ul>
<h3>Function score query</h3>
<p>用户可以通过自定义一个或多个查询语句来提高某些文档的比分权重，</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-function-score-query.html#query-dsl-function-score-query">https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-function-score-query.html#query-dsl-function-score-query</a></li>
</ul>
<p>还可以通过<strong>script_score</strong>使用脚本给每个文档重新打分</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-function-score-query.html#function-script-score">https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-function-score-query.html#function-script-score</a></li>
</ul>
<h3>Highlight</h3>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/highlighting.html#highlighting">https://www.elastic.co/guide/en/elasticsearch/reference/7.16/highlighting.html#highlighting</a></li>
</ul>
<h3>Prefix query</h3>
<p>使用前缀查询可以返回前缀为指定前缀的文档，多用于即时搜索一类的提示。</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-prefix-query.html#query-dsl-prefix-query">https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-prefix-query.html#query-dsl-prefix-query</a></li>
</ul>
<h3>Match phrase prefix query</h3>
<p>当需要对一个短语或词组进行前缀查询时，就需要用到来进行搜索了</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-match-query-phrase-prefix.html#query-dsl-match-query-phrase-prefix">https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-match-query-phrase-prefix.html#query-dsl-match-query-phrase-prefix</a></li>
</ul>
<h3>Named query</h3>
<p>通过使用<code>_name</code>参数可以在多字段查询时知道是哪个子查询语句命中了该文档，并将结果返回在每个响应文档的<code>matched_queries</code>字段内。</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-bool-query.html#named-queries">https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-bool-query.html#named-queries</a></li>
</ul>
<h3>Nested query</h3>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-nested-query.html#query-dsl-nested-query">https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-nested-query.html#query-dsl-nested-query</a></li>
</ul>
<h3>Exists query</h3>
<p>在某些情况下，并不是所有的字段都存在确切的值，可以通过<strong>Exists</strong>来或者筛选包含某些字段的文档，同时配合<strong>must_not</strong>可以来筛选所有存在该字段的文档。</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-exists-query.html#query-dsl-exists-query">https://www.elastic.co/guide/en/elasticsearch/reference/7.16/query-dsl-exists-query.html#query-dsl-exists-query</a></li>
</ul>
<h2>Scripts</h2>
<p>ES的脚本语言是<code>painless</code>，语法与Java类似，可直接按照Java的语法来编写检索脚本，具体可见地址：<a href="https://www.elastic.co/guide/en/elasticsearch/painless/7.16/painless-api-reference-shared.html">Shard API </a>。</p>
<p>这里只记录一下自己使用到的，以便以后再遇到可直接CV。</p>
<h3>删除数组内满足条件的元素</h3>
<p>使用<strong>removeIf</strong>来完成，例如删除ID为10的元素</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;script&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;ctx._source.members.removeIf(list_item -&gt; list_item.id == params.member_id)&quot;</span><span class="p">,</span>
    <span class="nt">&quot;lang&quot;</span><span class="p">:</span> <span class="s2">&quot;painless&quot;</span><span class="p">,</span>
    <span class="nt">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;member_id&quot;</span><span class="p">:</span> <span class="mi">10</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h3>判断数组内是否包含某一个对象</h3>
<p>使用<strong>contains</strong>来完成，返回包含<code>name</code>为<strong>张三</strong>的文档</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;script&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;ctx._source.members.contains(params.name)&quot;</span><span class="p">,</span>
    <span class="nt">&quot;lang&quot;</span><span class="p">:</span> <span class="s2">&quot;painless&quot;</span><span class="p">,</span>
    <span class="nt">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;张三&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h3>根据时间提高某些文档的权重</h3>
<p>使用时间格式化方法<strong>toInstant</strong>和<strong>toEpochMilli</strong>来完成，将时间转换成毫秒级权重因子</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;script&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;lang&quot;</span><span class="p">:</span> <span class="s2">&quot;painless&quot;</span><span class="p">,</span> 
        <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;double dateScore; try {dateScore = Math.abs(doc[&#39;enforcementDate&#39;].value.toInstant().toEpochMilli()/1e12);} catch (Exception e) {dateScore=0;} return dateScore;&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
    </div>

    <div class="article-attrs">
        <div class="article-detail-date">
            <time>Posted on 2021-12-04</time>
        </div>

        <div class="article-category">
            <span>
                Archived in <a href="/category/Tech.html">Tech</a>
            </span>
        </div>

        <div class="article-tags">
            <ul>
                
                    <li>
                        # <a href="/tag/Elasticsearch.html">Elasticsearch</a>
                    </li>
                
                    <li>
                        # <a href="/tag/技术笔记.html">技术笔记</a>
                    </li>
                
            </ul>
        </div>

    </div>

    
    
    

</main>

<footer>
    &copy; 2020-2022 ·
    <a href="/sitemap.xml">Sitemap</a> ·
    
    
    Powered by <a href="https://github.com/Cocojcc/zogn">zogn</a>
</footer>


</body>
</html>